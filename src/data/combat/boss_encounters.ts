import { CombatEncounter, CombatAction, EnemyTemplate, BossPhase } from '../../types/combat';

// ==========================================
// ADMIRAL VASSHEN - WARDENSEA COMMANDER
// ==========================================
// Act 2 boss. The official Wardensea response personified.
// Disciplined Iron Dominion user. Fights like an institution.

const VASSHEN_ACTIONS: CombatAction[] = [
  {
    id: 'vasshen_admirals_authority',
    name: 'Admiral\'s Authority',
    description: 'A command strike backed by decades of Wardensea Iron discipline.',
    category: 'strike',
    targetType: 'single',
    damage: 45,
    damageType: 'dominion_iron',
    accuracy: 88,
    cooldown: 0,
    currentCooldown: 0,
    staminaCost: 14,
    animation: 'iron_pulse',
    flavorText: 'Vasshen steps forward. No wasted motion. The blade comes down with the weight of the entire Wardensea behind it, Iron so dense the air warps around the edge.',
    missText: 'You read the angle. Academy-perfect form is Academy-predictable form.',
    effects: [
      { type: 'bleed', value: 5, duration: 2, chance: 35, description: 'Regulation cut' },
    ],
  },
  {
    id: 'vasshen_division_formation',
    name: 'Division Formation',
    description: 'The Admiral rallies her troops into tight defensive order.',
    category: 'defend',
    targetType: 'self',
    damage: 0,
    damageType: 'physical',
    accuracy: 100,
    cooldown: 3,
    currentCooldown: 0,
    staminaCost: 12,
    animation: 'crew_assist',
    flavorText: '"Formation! Close ranks!" The soldiers snap into position. Vasshen\'s Iron radiates outward, a field command that stiffens spines and steadies hands.',
    missText: '',
    effects: [
      { type: 'buff_defense', value: 20, duration: 2, chance: 100, description: 'Division formation' },
      { type: 'heal', value: 25, duration: 1, chance: 100, description: 'Rally morale' },
      { type: 'buff_attack', value: 10, duration: 2, chance: 100, description: 'Coordinated offensive' },
    ],
  },
  {
    id: 'vasshen_iron_judgment',
    name: 'Iron Judgment',
    description: 'Concentrated Iron Dominion channeled through a Wardensea admiral\'s blade.',
    category: 'dominion',
    targetType: 'single',
    damage: 55,
    damageType: 'dominion_iron',
    accuracy: 80,
    cooldown: 2,
    currentCooldown: 0,
    staminaCost: 22,
    animation: 'iron_pulse',
    flavorText: 'The blade glows white. Vasshen\'s eyes go flat, the look of someone who has sentenced thousands. The strike lands like a verdict. No appeal.',
    missText: 'The Iron discharge cracks the deck where you stood. Vasshen\'s expression doesn\'t change. She resets. Patient.',
    effects: [
      { type: 'stun', value: 1, duration: 1, chance: 40, description: 'Iron concussion' },
      { type: 'weaken', value: 10, duration: 2, chance: 50, description: 'Dominion suppression' },
    ],
  },
  {
    id: 'vasshen_tactical_withdrawal',
    name: 'Tactical Withdrawal',
    description: 'The Admiral falls back, reassesses, and shores up her position.',
    category: 'defend',
    targetType: 'self',
    damage: 0,
    damageType: 'physical',
    accuracy: 100,
    cooldown: 4,
    currentCooldown: 0,
    staminaCost: 8,
    animation: 'block',
    flavorText: 'Vasshen steps back. Not retreating. Repositioning. Her breathing steadies. Her grip shifts. She\'s fought longer campaigns than you\'ve been alive.',
    missText: '',
    effects: [
      { type: 'buff_defense', value: 15, duration: 2, chance: 100, description: 'Defensive reposition' },
      { type: 'heal', value: 20, duration: 1, chance: 100, description: 'Stamina recovery' },
    ],
  },
  {
    id: 'vasshen_execute_order',
    name: 'Execute Order',
    description: 'When cornered, the Admiral stops capturing and starts killing.',
    category: 'special',
    targetType: 'single',
    damage: 70,
    damageType: 'dominion_iron',
    accuracy: 85,
    cooldown: 3,
    currentCooldown: 0,
    staminaCost: 30,
    animation: 'flash_red',
    flavorText: '"Lethal force authorized." Vasshen\'s blade ignites with raw Iron, not the controlled glow of discipline but the white heat of someone who has decided you die here. The cut is fast. Faster than anything she\'s shown before.',
    missText: 'You feel it pass your throat. An inch. Maybe less. The Admiral\'s mask cracks for half a second. Then it\'s back.',
    effects: [
      { type: 'bleed', value: 10, duration: 3, chance: 60, description: 'Execution wound' },
      { type: 'expose', value: 15, duration: 2, chance: 45, description: 'Shattered guard' },
    ],
  },
];

const VASSHEN_PHASE_2_ACTIONS: CombatAction[] = [
  {
    id: 'vasshen_full_authority',
    name: 'Full Authority',
    description: 'Vasshen fights with the full weight of her rank. Every strike is a death sentence.',
    category: 'special',
    targetType: 'single',
    damage: 65,
    damageType: 'dominion_iron',
    accuracy: 88,
    cooldown: 3,
    currentCooldown: 0,
    staminaCost: 28,
    animation: 'flash_red',
    flavorText: 'Vasshen\'s coat falls away. The saber glows white, not with anger but with absolute conviction. She is the Wardensea. The full weight of it. The strike comes down like a gavel. Sentence: death.',
    missText: 'You are faster than her institution. The gavel strikes the deck. The wood splinters. She resets. Cold. Patient. But breathing harder now.',
    effects: [
      { type: 'bleed', value: 8, duration: 3, chance: 50, description: 'Deep execution wound' },
      { type: 'weaken', value: 12, duration: 2, chance: 60, description: 'Institutional pressure' },
    ],
  },
];

const vasshenBossPhases: BossPhase[] = [
  {
    id: 'vasshen_phase_2',
    name: 'FULL AUTHORITY',
    hpThreshold: 50,
    narration: [
      'Vasshen takes a step back. Blood on her coat. Blood on her saber. She looks at it the way someone looks at a bill they didn\'t expect.',
      '"You\'re better than your file suggested." She straightens. Her off-hand reaches up and unbuckles the grey Wardensea coat. It falls to the deck. Underneath: scarred arms, a body that has survived thirty years of this.',
      'The Iron around her blade intensifies. Not the controlled hum of institutional discipline. Something rawer. Deeper. The Iron of someone who earned their rank in the field, not behind a desk.',
      '"Full authority. No restrictions. No regulations." Her eyes are flat. Cold. "Now we see who you really are."',
    ],
    statChanges: { attack: 8, speed: 4 },
    newActions: VASSHEN_PHASE_2_ACTIONS,
    aiPatternChange: 'aggressive',
    triggered: false,
  },
];

const admiralVasshen: EnemyTemplate = {
  id: 'admiral_vasshen',
  name: 'Admiral Vasshen',
  title: 'Wardensea First Division Commander',
  tier: 'boss',
  hp: 280,
  stamina: 130,
  attack: 27,
  defense: 26,
  speed: 24,
  dominion: { iron: 72, sight: 35, king: 20 },
  actions: VASSHEN_ACTIONS,
  aiPattern: 'tactical',
  flavorIntro: 'Admiral Vasshen steps onto the deck like she owns it. Because, legally, she does. Grey coat trimmed in silver. Iron-forged saber, Academy Class of \'04. Thirty years of service in the lines around her eyes. She looks at you the way a surgeon looks at a tumor.',
  flavorDefeat: 'Vasshen drops to one knee. The saber clatters from her hand. She looks up at you, not with fear, not with anger. With the cold recognition of someone who has just watched their career end. "This changes nothing. The Wardensea is bigger than one admiral." She might be right.',
  bossPhases: vasshenBossPhases,
};

// Vasshen's escort soldiers - fresh templates, not imported
const vasshenSoldier: EnemyTemplate = {
  id: 'vasshen_escort',
  name: 'Wardensea Escort',
  tier: 'soldier',
  hp: 63,
  stamina: 60,
  attack: 10,
  defense: 15,
  speed: 22,
  dominion: { iron: 22, sight: 14, king: 0 },
  actions: [
    {
      id: 'escort_saber',
      name: 'Fleet Saber',
      description: 'Standard-issue. Kept sharp.',
      category: 'strike',
      targetType: 'single',
      damage: 24,
      damageType: 'physical',
      accuracy: 84,
      cooldown: 0,
      currentCooldown: 0,
      staminaCost: 8,
      animation: 'slash',
      flavorText: 'The escort lunges. Admiral\'s guard. They fight harder when the old man is watching.',
      missText: 'Academy footwork. You\'ve seen it a dozen times now.',
    },
    {
      id: 'escort_brace',
      name: 'Shield Wall',
      description: 'Defensive stance. Protect the Admiral.',
      category: 'defend',
      targetType: 'self',
      damage: 0,
      damageType: 'physical',
      accuracy: 100,
      cooldown: 2,
      currentCooldown: 0,
      staminaCost: 6,
      animation: 'block',
      flavorText: 'The escort drops into a low guard. Eyes on you. Blade between you and Vasshen.',
      missText: '',
      effects: [
        { type: 'buff_defense', value: 18, duration: 2, chance: 100, description: 'Shield wall' },
      ],
    },
    {
      id: 'escort_coordinated_slash',
      name: 'Fleet Strike',
      description: 'Paired attack with adjacent soldier.',
      category: 'strike',
      targetType: 'single',
      damage: 30,
      damageType: 'physical',
      accuracy: 76,
      cooldown: 2,
      currentCooldown: 0,
      staminaCost: 12,
      animation: 'slash',
      flavorText: 'Two escorts move as one. Mirror-image cuts from opposite angles. The Admiral\'s personal guard drills this maneuver daily.',
      missText: 'You break between them. Their blades cross where you were.',
      effects: [
        { type: 'bleed', value: 5, duration: 2, chance: 30, description: 'Cross-cut' },
      ],
    },
  ],
  aiPattern: 'defensive',
  flavorIntro: 'Admiral\'s personal escort. Better-equipped than standard line soldiers. They fight like their careers depend on it. They do.',
  flavorDefeat: 'The escort goes down hard. The grey coat darkens with blood. They don\'t get back up.',
};

export const vasshenEncounter: CombatEncounter = {
  id: 'vasshen_confrontation',
  title: 'THE WARDENSEA RESPONDS',
  subtitle: 'Admiral Vasshen. First Division. Full authority.',
  narrativeIntro: [
    'The flagship comes in with the tide. No signal flags, no warning shots. Wardensea First Division, flying the Admiral\'s pennant. This is not a patrol. This is not a probe. This is the official response.',
    'Vasshen boards your ship personally. Twenty-year veterans flank her. She walks the deck like it\'s already been seized and catalogued.',
    '"Karyudon." She says your name like she\'s reading it from a warrant. "I\'ve read your file. Every incident, every act of resistance, every territory you\'ve claimed. I want you to understand something."',
    'She draws her saber. The blade hums with Iron, deep, resonant, Dominion built over decades of service.',
    '"I am not the officers you\'ve beaten. I am not the patrols you\'ve scattered. I am the Wardensea\'s answer to the question you keep asking."',
    'You lift the Danzai. "Then let\'s hear the answer."',
  ],
  narrativeVictory: [
    'Vasshen\'s flagship pulls away. The Admiral stands at the rail, watching you. Her arm is in a sling. Her coat is torn. But she\'s alive, and you let her leave.',
    'Vorreth watches the ship recede. "She\'ll be back. Officers like Vasshen don\'t retire after one loss. They study it." He would know. He spent years fighting the Wardensea across the Daaz Accord, watching their admirals learn and adapt between engagements.',
    '"Good," you say. "Let him study."',
    'The Bastion Sea is watching. An Oni just beat a Wardensea Admiral in open combat. The word will spread. The balance of power just changed.',
  ],
  narrativeDefeat: [
    'Vasshen is too good. The Iron behind her blade is institutional, the weight of the entire Wardensea compressed into one officer\'s sword arm. You go down.',
    'But she doesn\'t kill you. She stands over you, saber pointed at your throat, and says: "Not today. You\'re worth more alive. The trial will be public." She turns to her soldiers. "Secure the prisoner."',
    'Vorreth steps forward, hand on his own blade. The situation is not over.',
  ],
  enemies: [admiralVasshen, vasshenSoldier, vasshenSoldier],
  waves: [
    [vasshenSoldier, vasshenSoldier],
  ],
  rewards: [
    { type: 'reputation', value: 15, label: '+15 Reputation' },
    { type: 'infamy', value: 10, label: '+10 Infamy' },
    { type: 'bounty', value: 30000000, label: '+30M Bounty' },
    { type: 'intelligence', value: 20, label: '+20 Intelligence (Wardensea deployment data)' },
    { type: 'sovereigns', value: 300, label: '+300 Sovereigns (seized supplies)' },
  ],
  defeatConsequence: 'retreat',
  availableCrew: ['dragghen', 'vorreth', 'suulen', 'delvessa', 'kovesse', 'tessek', 'orren'],
  onVictoryEffects: [
    { type: 'flag', target: 'vasshen_defeated', value: true },
    { type: 'notification', value: true, notification: {
      type: 'wardensea',
      title: 'WARDENSEA COMMAND - PRIORITY ALERT',
      message: 'Admiral Vasshen engaged the Oni fugitive Karyudon in direct combat. First Division flagship sustained damage. Admiral alive but wounded. Full tactical reassessment ordered. Threat classification upgraded to CRITICAL.',
    }},
  ],
  onDefeatEffects: [
    { type: 'flag', target: 'vasshen_defeated', value: false },
    { type: 'flag', target: 'vasshen_encounter_lost', value: true },
  ],
};


// ==========================================
// TESSAVARRA - CONQUEROR 4TH SEAT
// ==========================================
// A Conqueror faction leader. Sight and King Dominion.
// Fights with deception and cunning. Lean roster - no waves.

const TESSAVARRA_ACTIONS: CombatAction[] = [
  {
    id: 'tessavarra_ghostlight_blade',
    name: 'Ghostlight Blade',
    description: 'A strike guided by Sight. The blade finds openings that shouldn\'t exist.',
    category: 'strike',
    targetType: 'single',
    damage: 42,
    damageType: 'dominion_sight',
    accuracy: 92,
    cooldown: 0,
    currentCooldown: 0,
    staminaCost: 12,
    animation: 'sight_flash',
    flavorText: 'Tessavarra\'s blade shimmers, there and not there. The cut lands before you see it leave her hand. Sight Dominion. She\'s reading your body before you decide to move.',
    missText: 'You move on instinct, not thought. She can\'t read what you don\'t plan.',
    effects: [
      { type: 'bleed', value: 6, duration: 2, chance: 40, description: 'Phantom cut' },
    ],
  },
  {
    id: 'tessavarra_phantom_step',
    name: 'Phantom Step',
    description: 'Tessavarra blurs. Where she was is not where she is.',
    category: 'defend',
    targetType: 'self',
    damage: 0,
    damageType: 'physical',
    accuracy: 100,
    cooldown: 3,
    currentCooldown: 0,
    staminaCost: 10,
    animation: 'sight_flash',
    flavorText: 'She moves, sideways, backward, it\'s hard to tell. Your eyes insist she\'s in two places at once. Sight Dominion bending perception.',
    missText: '',
    effects: [
      { type: 'buff_defense', value: 25, duration: 2, chance: 100, description: 'Phantom evasion' },
      { type: 'buff_attack', value: 15, duration: 2, chance: 100, description: 'Repositioned for the kill' },
    ],
  },
  {
    id: 'tessavarra_conquerors_will',
    name: 'Conqueror\'s Will',
    description: 'King Dominion pressure. The air thickens. Your knees want to bend.',
    category: 'dominion',
    targetType: 'all',
    damage: 30,
    damageType: 'dominion_king',
    accuracy: 82,
    cooldown: 3,
    currentCooldown: 0,
    staminaCost: 20,
    animation: 'king_pressure',
    flavorText: 'Tessavarra smiles. The air changes. Pressure builds behind your eyes, in your chest, along your spine. King Dominion, raw will made physical. She wants you on your knees.',
    missText: 'You plant your feet and push back. Your own King flares. She feels it. The smile falters.',
    effects: [
      { type: 'weaken', value: 12, duration: 2, chance: 55, description: 'Conqueror\'s pressure' },
      { type: 'intimidate', value: 8, duration: 2, chance: 40, description: 'Willpower drain' },
    ],
  },
  {
    id: 'tessavarra_shadow_double',
    name: 'Shadow Double',
    description: 'An afterimage made real by Sight. It fights. It bleeds. It isn\'t her.',
    category: 'special',
    targetType: 'self',
    damage: 0,
    damageType: 'dominion_sight',
    accuracy: 100,
    cooldown: 4,
    currentCooldown: 0,
    staminaCost: 18,
    animation: 'sight_flash',
    flavorText: 'A second Tessavarra peels off the first like a shadow gaining depth. It draws a blade. It takes a stance. Your Sight tells you it\'s fake. Your instincts aren\'t sure.',
    missText: '',
    effects: [
      { type: 'buff_attack', value: 20, duration: 3, chance: 100, description: 'Shadow double active' },
      { type: 'buff_defense', value: 10, duration: 3, chance: 100, description: 'Which one is real?' },
    ],
  },
  {
    id: 'tessavarra_final_gambit',
    name: 'Final Gambit',
    description: 'Everything she has left in one strike. Conquerors don\'t do half measures.',
    category: 'special',
    targetType: 'single',
    damage: 65,
    damageType: 'dominion_sight',
    accuracy: 83,
    cooldown: 4,
    currentCooldown: 0,
    staminaCost: 35,
    animation: 'flash_red',
    flavorText: 'Tessavarra stops smiling. Her eyes go white. Pure Sight flooding every nerve. She sees every possible future and picks the one where her blade goes through your heart. The strike comes from everywhere at once.',
    missText: 'You choose a future she didn\'t predict. The blade passes through empty air. Tessavarra staggers. That cost her.',
    effects: [
      { type: 'bleed', value: 8, duration: 3, chance: 50, description: 'Deep laceration' },
      { type: 'expose', value: 12, duration: 2, chance: 60, description: 'Defenses shredded' },
    ],
  },
];

const TESSAVARRA_PHASE_2_ACTIONS: CombatAction[] = [
  {
    id: 'tessavarra_true_sight',
    name: 'True Sight',
    description: 'Tessavarra stops holding back. The full force of her Sight laid bare.',
    category: 'dominion',
    targetType: 'all',
    damage: 45,
    damageType: 'dominion_sight',
    accuracy: 90,
    cooldown: 3,
    currentCooldown: 0,
    staminaCost: 30,
    animation: 'flash_white',
    flavorText: 'Her eyes go white. Not metaphor. White. Light pours from them like lighthouse beams. The Sight hits you like a physical force, laying open every intention, every plan, every future you were considering. She sees it all. And she cuts accordingly.',
    missText: 'You close your own eyes. Fight blind. It works. She can\'t read what you can\'t see.',
    effects: [
      { type: 'expose', value: 20, duration: 2, chance: 70, description: 'Every secret laid bare' },
      { type: 'weaken', value: 10, duration: 2, chance: 60, description: 'Cognitive overload' },
    ],
  },
];

const tessavarraBossPhases: BossPhase[] = [
  {
    id: 'tessavarra_phase_2',
    name: 'TRUE SIGHT',
    hpThreshold: 40,
    narration: [
      'Tessavarra stumbles. For the first time since this started, the amusement drains from her face.',
      'She touches the blood on her side. Looks at it. Then looks at you with an expression you haven\'t seen from a Conqueror before.',
      'Interest.',
      '"Alright." She straightens. Her blade drops to her side. Her eyes begin to glow. Not the shimmer of casual Sight use. This is full Dominion, unrestricted, Dominion that burns through the user. The warehouse lights dim. "I was testing you before. Sizing up the investment." The glow intensifies. White. Blinding. "Now I\'m fighting."',
    ],
    statChanges: { attack: 7, speed: 6, defense: -5 },
    newActions: TESSAVARRA_PHASE_2_ACTIONS,
    aiPatternChange: 'aggressive',
    triggered: false,
  },
];

const tessavarra: EnemyTemplate = {
  id: 'tessavarra',
  name: 'Tessavarra',
  title: 'Conqueror 4th Seat',
  tier: 'boss',
  hp: 224,
  stamina: 120,
  attack: 25,
  defense: 20,
  speed: 30,
  dominion: { iron: 25, sight: 70, king: 50 },
  actions: TESSAVARRA_ACTIONS,
  aiPattern: 'tactical',
  flavorIntro: 'She\'s been sitting in the corner of the room for the last hour. You didn\'t notice. Nobody noticed. That\'s the point. Tessavarra, 4th Seat of the Conquerors, unfolds from her chair like smoke taking shape. Dark hair, dark eyes, a mouth that defaults to amusement. The blade on her hip is thin as a letter opener and twice as dangerous.',
  flavorDefeat: 'Tessavarra hits the ground and laughs. Blood on her teeth. "Oh, that was worth it. That was absolutely worth it." She looks up at you with something worse than hatred. Respect. "I\'ll remember this. You should worry about that."',
  bossPhases: tessavarraBossPhases,
};

// Tessavarra's lieutenant - a new elite template
const conquerorLieutenant: EnemyTemplate = {
  id: 'conqueror_lieutenant',
  name: 'Conqueror Lieutenant',
  title: 'Tessavarra\'s Right Hand',
  tier: 'elite',
  hp: 112,
  stamina: 85,
  attack: 16,
  defense: 16,
  speed: 28,
  dominion: { iron: 20, sight: 42, king: 10 },
  actions: [
    {
      id: 'conq_lt_feint_slash',
      name: 'Feint Slash',
      description: 'Looks left, cuts right. Conqueror standard.',
      category: 'strike',
      targetType: 'single',
      damage: 28,
      damageType: 'dominion_sight',
      accuracy: 86,
      cooldown: 0,
      currentCooldown: 0,
      staminaCost: 10,
      animation: 'slash',
      flavorText: 'The lieutenant shows you a low guard. The attack comes high. Sight-enhanced misdirection, not as good as Tessavarra\'s, but good enough to draw blood.',
      missText: 'You ignore the feint. The lieutenant\'s eyes widen. They\'re used to the trick working.',
    },
    {
      id: 'conq_lt_sight_screen',
      name: 'Sight Screen',
      description: 'Minor Sight Dominion. Blurs their outline.',
      category: 'defend',
      targetType: 'self',
      damage: 0,
      damageType: 'physical',
      accuracy: 100,
      cooldown: 3,
      currentCooldown: 0,
      staminaCost: 10,
      animation: 'sight_flash',
      flavorText: 'The lieutenant\'s outline blurs. Not invisible. Just wrong. Hard to target.',
      missText: '',
      effects: [
        { type: 'buff_defense', value: 20, duration: 2, chance: 100, description: 'Sight screen' },
      ],
    },
    {
      id: 'conq_lt_throat_strike',
      name: 'Throat Strike',
      description: 'Conquerors aim for endings.',
      category: 'strike',
      targetType: 'single',
      damage: 36,
      damageType: 'physical',
      accuracy: 74,
      cooldown: 2,
      currentCooldown: 0,
      staminaCost: 14,
      animation: 'slash',
      flavorText: 'Fast. Direct. The blade goes for your throat with the casual precision of someone who has done this before. Many times.',
      missText: 'Your horns catch the blade. The lieutenant reassesses. Oni anatomy remains a problem for human-trained fighters.',
      effects: [
        { type: 'bleed', value: 7, duration: 2, chance: 45, description: 'Throat cut' },
        { type: 'weaken', value: 8, duration: 1, chance: 30, description: 'Gasping' },
      ],
    },
  ],
  aiPattern: 'aggressive',
  flavorIntro: 'Tall, scarred, expressionless. Tessavarra\'s lieutenant has the look of someone who does the work their boss finds distasteful. Which, given Tessavarra, means they handle things even a Conqueror finds excessive.',
  flavorDefeat: 'The lieutenant falls. No last words. Professionals don\'t waste breath.',
};

export const tessavarraEncounter: CombatEncounter = {
  id: 'tessavarra_confrontation',
  title: 'THE 4TH SEAT\'S GAME',
  subtitle: 'Tessavarra was always going to test you. The test is lethal.',
  narrativeIntro: [
    'You knew this was coming. Tessavarra has been circling for weeks: messages, intermediaries, that amused tone in every Grimoire post about you. The 4th Seat of the Conquerors doesn\'t make allies. She makes investments. And she wants to know what you\'re worth.',
    'She picks the location. An empty warehouse on the Keldriss waterfront. Neutral ground, if anything in the Bastion Sea is neutral. Her lieutenant is already inside when you arrive.',
    '"Karyudon." She steps out of a shadow that shouldn\'t be deep enough to hide a person. "I\'ve been looking forward to this. The Conquerors are interested in your little empire. Specifically, whether you deserve it."',
    '"And if I don\'t?"',
    'She draws her blade. Thin. Elegant. Wrong in a way your Sight can\'t quite pin down.',
    '"Then I take it. Standard Conqueror policy." She smiles. "Let\'s find out."',
  ],
  narrativeVictory: [
    'Tessavarra is on the ground. Her lieutenant is unconscious against the far wall. The warehouse smells like ozone and blood.',
    'She laughs. Pushes herself up on one elbow. "Well. That settles the investment question." She coughs. "The Conquerors won\'t move against your territories. Not while I hold my seat. Consider that a professional courtesy."',
    '"And when you lose your seat?"',
    '"Then you\'ll have bigger problems than me." She stands. Limps toward the door. Pauses. "I\'ll be in touch, Karyudon. People like us. We always end up in the same room eventually."',
    'Delvessa appears beside you. She watched the whole fight from somewhere you couldn\'t see. "That woman is going to be a problem."',
    '"She already is," you say. "But at least she\'s our kind of problem."',
  ],
  narrativeDefeat: [
    'Tessavarra is faster than you expected. The Sight Dominion lets her read your movements before you commit to them, and the King pressure keeps your crew off-balance. She takes you apart with surgical precision.',
    'She stands over you. Blade at your throat. "Disappointing. I had hoped for more." She sheathes her weapon. "I won\'t kill you. Dead Oni are worth nothing. But the Conquerors will remember that the great Karyudon fell to the 4th Seat."',
    'She leaves. Her lieutenant follows. The warehouse is silent except for the sound of your pride bleeding out.',
  ],
  enemies: [tessavarra, conquerorLieutenant],
  rewards: [
    { type: 'intelligence', value: 25, label: '+25 Intelligence (Conqueror operations data)' },
    { type: 'reputation', value: 10, label: '+10 Reputation' },
    { type: 'infamy', value: 8, label: '+8 Infamy' },
    { type: 'bounty', value: 20000000, label: '+20M Bounty' },
    { type: 'sovereigns', value: 200, label: '+200 Sovereigns' },
  ],
  defeatConsequence: 'retreat',
  availableCrew: ['dragghen', 'vorreth', 'suulen', 'delvessa', 'kovesse', 'tessek', 'orren'],
  onVictoryEffects: [
    { type: 'flag', target: 'tessavarra_defeated', value: true },
    { type: 'notification', value: true, notification: {
      type: 'grimoire',
      title: 'GRIMOIRE TRENDING - #4thSeatDown',
      message: 'Unconfirmed reports: Conqueror 4th Seat Tessavarra engaged the Oni Karyudon in single combat and lost. Conqueror internal channels have gone dark. The power structure of the Bastion Sea just got more complicated.',
    }},
  ],
  onDefeatEffects: [
    { type: 'flag', target: 'tessavarra_defeated', value: false },
    { type: 'flag', target: 'tessavarra_encounter_lost', value: true },
  ],
};


// ==========================================
// KOLMARI IRONCLAD - THE MACHINE
// ==========================================
// Not a person. A Kolmari-built combat automaton.
// No Dominion. Pure mechanical force. Solo boss - no minions.

const KOLMARI_IRONCLAD_ACTIONS: CombatAction[] = [
  {
    id: 'ironclad_piston_strike',
    name: 'Piston Strike',
    description: 'Hydraulic fist. No technique. Just pressure per square inch.',
    category: 'strike',
    targetType: 'single',
    damage: 55,
    damageType: 'physical',
    accuracy: 75,
    cooldown: 0,
    currentCooldown: 0,
    staminaCost: 12,
    animation: 'heavy_smash',
    flavorText: 'The arm telescopes out. Piston-driven, faster than something that big should move. The impact cracks the deck planking and sends splinters flying. This thing hits like a collapsing building.',
    missText: 'You dodge. The fist buries in the wall. Gears whine as it retracts. Slow recovery. That\'s your window.',
    effects: [
      { type: 'stun', value: 1, duration: 1, chance: 30, description: 'Concussive impact' },
    ],
  },
  {
    id: 'ironclad_pressure_vent',
    name: 'Pressure Vent',
    description: 'Superheated steam expelled from every joint. Area denial.',
    category: 'strike',
    targetType: 'all',
    damage: 35,
    damageType: 'physical',
    accuracy: 80,
    cooldown: 2,
    currentCooldown: 0,
    staminaCost: 18,
    animation: 'screen_shake',
    flavorText: 'Every joint on the machine blows open. Superheated steam screams outward in a white wall. The temperature spikes. Metal groans. The air itself burns.',
    missText: 'You drop flat. The steam passes over you. Your skin reddens but holds. Close.',
    effects: [
      { type: 'bleed', value: 6, duration: 2, chance: 40, description: 'Steam burns' },
      { type: 'weaken', value: 8, duration: 1, chance: 50, description: 'Heat exhaustion' },
    ],
  },
  {
    id: 'ironclad_armor_lock',
    name: 'Armor Lock',
    description: 'Plates shift. Seal. The machine becomes a wall.',
    category: 'defend',
    targetType: 'self',
    damage: 0,
    damageType: 'physical',
    accuracy: 100,
    cooldown: 3,
    currentCooldown: 0,
    staminaCost: 10,
    animation: 'block',
    flavorText: 'The Ironclad stops moving. Plates slide, overlap, lock. The sound is industrial, factory-floor precision. For a few seconds, this thing is solid metal. No gaps. No weak points.',
    missText: '',
    effects: [
      { type: 'buff_defense', value: 35, duration: 2, chance: 100, description: 'Armor lock engaged' },
      { type: 'shield', value: 30, duration: 2, chance: 100, description: 'Sealed plating' },
    ],
  },
  {
    id: 'ironclad_overload',
    name: 'Overload',
    description: 'Core breach. Everything goes. Including the machine.',
    category: 'special',
    targetType: 'all',
    damage: 75,
    damageType: 'physical',
    accuracy: 90,
    cooldown: 5,
    currentCooldown: 0,
    staminaCost: 40,
    animation: 'flash_red',
    flavorText: 'The core light turns red. Then white. The machine shakes, a full-body tremor that cracks its own plating. The explosion is concussive, mechanical, absolute. Shrapnel and pressure wave and raw force. The Ironclad damages itself to destroy everything around it.',
    missText: 'You get behind cover. The shockwave still rattles your teeth. Shrapnel pings off your horns. The machine is smoking, cracked, still standing.',
    effects: [
      { type: 'stun', value: 1, duration: 1, chance: 60, description: 'Shockwave' },
      { type: 'bleed', value: 10, duration: 3, chance: 50, description: 'Shrapnel wounds' },
      { type: 'expose', value: 15, duration: 2, chance: 100, description: 'Cracked plating' },
    ],
  },
];

const IRONCLAD_PHASE_2_ACTIONS: CombatAction[] = [
  {
    id: 'ironclad_siege_protocol',
    name: 'Siege Protocol',
    description: 'Emergency combat subroutine. The machine stops defending and starts destroying.',
    category: 'special',
    targetType: 'single',
    damage: 80,
    damageType: 'physical',
    accuracy: 82,
    cooldown: 3,
    currentCooldown: 0,
    staminaCost: 30,
    animation: 'heavy_smash',
    flavorText: 'Both arms lock into battering ram configuration. The red eye cycles to solid white. A sound like a locomotive at full steam. The Ironclad charges, eight hundred pounds of Kolmari steel moving at a speed that violates engineering specs. This was not in the brochure.',
    missText: 'You dodge. The Ironclad hits the wall. Goes through it. Keeps going. Stops. Recalculates. Turns. Comes back.',
    effects: [
      { type: 'stun', value: 1, duration: 1, chance: 55, description: 'Structural trauma' },
      { type: 'expose', value: 15, duration: 2, chance: 100, description: 'Overextended chassis' },
    ],
  },
];

const IRONCLAD_PHASE_3_ACTIONS: CombatAction[] = [
  {
    id: 'ironclad_core_overload',
    name: 'Core Overload',
    description: 'The machine dumps its entire power reserve into a single devastating blast. It hurts you. It hurts itself.',
    category: 'special',
    targetType: 'single',
    damage: 110,
    damageType: 'physical',
    accuracy: 75,
    cooldown: 4,
    currentCooldown: 0,
    staminaCost: 40,
    animation: 'heavy_smash',
    flavorText: 'The Ironclad\'s chest plates split open. Light pours out, copper-white and screaming. The power core pulses once, twice, and then detonates outward. The blast hits everything in front of it. Including the machine itself. Plating cracks. Joints warp. Something inside it ruptures.',
    missText: 'You see the chest plates opening and throw yourself sideways. The blast tears through the space where you stood. The Ironclad staggers, smoke pouring from its own ruptured core.',
    effects: [
      { type: 'stun', value: 1, duration: 1, chance: 70, description: 'Concussive overload' },
      { type: 'expose', value: 20, duration: 2, chance: 100, description: 'Core breach' },
    ],
  },
  {
    id: 'ironclad_terminal_sweep',
    name: 'Terminal Sweep',
    description: 'Both arms swing in a full-circle arc. No targeting. No precision. Just destruction.',
    category: 'strike',
    targetType: 'single',
    damage: 65,
    damageType: 'physical',
    accuracy: 90,
    cooldown: 2,
    currentCooldown: 0,
    staminaCost: 25,
    animation: 'slash',
    flavorText: 'The Ironclad spins. Both arms extended. Eight hundred pounds of steel moving in a circle that doesn\'t care about aim, form, or structural integrity. The sweep catches everything in range. The machine\'s own joints scream under the torque.',
    missText: 'You drop flat. The sweep passes over you close enough to part your hair. One of the machine\'s arms bends at an angle that wasn\'t in the specs.',
    effects: [
      { type: 'expose', value: 10, duration: 2, chance: 100, description: 'Shattered guard' },
      { type: 'bleed', value: 8, duration: 3, chance: 45, description: 'Shrapnel wounds' },
    ],
  },
];

const ironcladBossPhases: BossPhase[] = [
  {
    id: 'ironclad_phase_2',
    name: 'SIEGE PROTOCOL',
    hpThreshold: 60,
    narration: [
      'The Ironclad staggers. Sparks shower from a ruptured shoulder joint. Hydraulic fluid leaks from its left arm.',
      'For two seconds, it stops. The red eye dims. The hum drops to silence.',
      'Then something inside it clicks. A sound like a lock turning. The eye relights. Not red. White.',
      'New plates slide from hidden compartments in its torso, covering the damage. The arms reconfigure, pistons extending, locking into a wider, heavier stance. Steam vents from its back in a continuous scream.',
      'The machine was holding back. It was fighting at regulation output. Whatever just activated is the Kolmari\'s idea of a last resort.',
    ],
    statChanges: { attack: 11, speed: -4, defense: -10 },
    heal: 40,
    newActions: IRONCLAD_PHASE_2_ACTIONS,
    aiPatternChange: 'berserker',
    triggered: false,
  },
  {
    id: 'ironclad_phase_3',
    name: 'CRITICAL MASS',
    hpThreshold: 25,
    narration: [
      'The Ironclad is falling apart. Plating hangs from exposed joints. The white eye flickers. Internal fires glow through cracks in its chassis.',
      'It should be dead. Dragghen would rate it a solid two on structural integrity.',
      'But the core is still running. The hum is no longer mechanical. It\'s a whine. A scream. The power coupling Suulen noticed is overloading, feeding everything the machine has left into raw output.',
      'The Ironclad isn\'t trying to win anymore. It\'s trying to take you with it.',
    ],
    statChanges: { attack: 14, defense: -15 },
    newActions: IRONCLAD_PHASE_3_ACTIONS,
    aiPatternChange: 'berserker',
    triggered: false,
  },
];

const kolmariIronclad: EnemyTemplate = {
  id: 'kolmari_ironclad',
  name: 'Kolmari Ironclad',
  title: 'The Machine',
  tier: 'boss',
  hp: 320,
  stamina: 100,
  attack: 29,
  defense: 30,
  speed: 18,
  dominion: { iron: 0, sight: 0, king: 0 },
  actions: KOLMARI_IRONCLAD_ACTIONS,
  aiPattern: 'berserker',
  flavorIntro: 'It steps out of the cargo hold. Eight feet of riveted steel, copper tubing, and Kolmari engineering. No face. No eyes. A single red light where a head should be, cycling left and right. It doesn\'t breathe. It doesn\'t think. It processes threats and eliminates them. The Kolmari\'s final argument when money doesn\'t work.',
  flavorDefeat: 'The Ironclad shudders. Sparks spray from ruptured joints. The red light flickers, on, off, on, off, then goes dark. The machine stands for one more second, momentum carrying it forward, and then crashes to the deck. Two tons of dead metal. Somewhere in a Kolmari boardroom, an accountant just started crying.',
  bossPhases: ironcladBossPhases,
};

export const kolmariIroncladEncounter: CombatEncounter = {
  id: 'kolmari_ironclad_fight',
  title: 'THE KOLMARI\'S FINAL ARGUMENT',
  subtitle: 'When contracts fail and bribes bounce, the Kolmari send the Machine.',
  narrativeIntro: [
    'Tessurren Dolch tried money first. Then lawyers. Then threats. Then more money. When none of it worked, she filed a requisition with Kolmari Central Engineering. The paperwork took three weeks. The deployment took two days.',
    'The cargo ship docks at dawn. Unmarked hull, Kolmari registry codes, a crew that won\'t make eye contact. They unload a single crate. Twenty feet long. Ten feet wide. Reinforced with iron bands thick enough to anchor a warship.',
    'The crate opens from the inside.',
    'Dragghen is the first to see it. He sets down his wrench, wiping grease on his apron. "Captain. That\'s not a person."',
    'The Ironclad unfolds itself from the crate. Joint by joint. Plate by plate. The red eye sweeps the dock, finds you, and locks on. A low hum builds in its chest: power cycling up, weapons arming, threat assessment complete.',
    'You draw the Danzai. "Alright. Let\'s see what Kolmari money buys."',
  ],
  narrativeVictory: [
    'The Ironclad is scrap. Expensive scrap. You stand over the wreckage, breathing hard, Danzai still sparking from the final blow. Kolmari engineering is impressive. But it\'s still engineering. It doesn\'t adapt. It doesn\'t improvise. It doesn\'t get angry.',
    'You do.',
    'Suulen kneels beside the wreckage. Her fingers trace the copper tubing. "This is remarkable work. The power coupling alone is worth a fortune." She looks up at you. "May I?"',
    '"Strip it. Take everything useful."',
    'Kovesse is already broadcasting. The footage of an Oni dismantling a combat automaton with a greatsword will be trending within the hour.',
    'Somewhere in the Kolmari headquarters, Tessurren Dolch is watching the same footage. You hope she\'s taking notes.',
  ],
  narrativeDefeat: [
    'The Machine is relentless. It doesn\'t tire, doesn\'t hesitate, doesn\'t bleed. Every time you land a hit, the plates shift to compensate. Every time you dodge, it recalculates.',
    'It pins you against the dock wall. The piston arm rears back for a killing blow.',
    'Vorreth hits it from behind with everything he has. The machine staggers. Not much. But enough. You roll clear. The fight isn\'t over, but round one goes to the machine.',
  ],
  enemies: [kolmariIronclad],
  rewards: [
    { type: 'materials', value: 50, label: '+50 Materials (salvaged Kolmari tech)' },
    { type: 'sovereigns', value: 500, label: '+500 Sovereigns (salvage value)' },
    { type: 'reputation', value: 12, label: '+12 Reputation' },
    { type: 'infamy', value: 6, label: '+6 Infamy' },
    { type: 'bounty', value: 15000000, label: '+15M Bounty' },
  ],
  defeatConsequence: 'retreat',
  availableCrew: ['dragghen', 'vorreth', 'suulen', 'delvessa', 'kovesse', 'tessek', 'orren'],
  onVictoryEffects: [
    { type: 'flag', target: 'kolmari_ironclad_destroyed', value: true },
    { type: 'notification', value: true, notification: {
      type: 'grimoire',
      title: 'GRIMOIRE TRENDING - #IroncladDown',
      message: 'FOOTAGE: Oni captain Karyudon destroys Kolmari combat automaton in dockside battle. Kolmari Engineering stock drops 4%. Tessurren Dolch unavailable for comment. Salvage rights disputed.',
    }},
  ],
  onDefeatEffects: [
    { type: 'flag', target: 'kolmari_ironclad_destroyed', value: false },
    { type: 'flag', target: 'kolmari_ironclad_encounter_lost', value: true },
  ],
};


// ==========================================
// ISLAND VILLAIN: TESSURREN DOLCH - "THE SQUEEZE"
// ==========================================
// Tavven Shoal. Every turn costs you Sovereigns.
// Beat him fast or go broke.

const TESSURREN_ACTIONS: CombatAction[] = [
  {
    id: 'tessurren_contract_lash',
    name: 'Contract Lash',
    description: 'The ledger chain whips forward. Each link inscribed with debt.',
    category: 'strike',
    targetType: 'single',
    damage: 22,
    damageType: 'dominion_sight',
    accuracy: 88,
    cooldown: 0,
    currentCooldown: 0,
    staminaCost: 10,
    animation: 'slash',
    flavorText: 'The chain uncoils. Each link catches light like a coin. The impact feels like a bill coming due -- sharp, precise, and designed to remind you what you owe.',
    missText: 'The chain cracks empty air. Dolch retracts it with a flick. "Evasion is not a payment plan."',
    effects: [
      { type: 'weaken', value: 3, duration: 3, chance: 100, description: 'Debt stack (-3 ATK)' },
    ],
  },
  {
    id: 'tessurren_lien',
    name: 'Asset Seizure',
    description: 'Binds the target in contract-inscribed chains. Dominion disruption.',
    category: 'dominion',
    targetType: 'single',
    damage: 30,
    damageType: 'dominion_sight',
    accuracy: 82,
    cooldown: 2,
    currentCooldown: 0,
    staminaCost: 18,
    animation: 'sight_flash',
    flavorText: 'Dolch reads your stance, your habits, your patterns. Sight Dominion focused through the lens of financial analysis. He doesn\'t see a person. He sees a liability. The chain wraps.',
    missText: 'You tear free. The chain links scatter like dropped coins. Dolch frowns. "Aggressive non-compliance. Noted."',
    effects: [
      { type: 'weaken', value: 3, duration: 3, chance: 100, description: 'Debt stack (-3 ATK)' },
      { type: 'stun', value: 1, duration: 1, chance: 35, description: 'Contractual bind' },
    ],
  },
  {
    id: 'tessurren_foreclosure',
    name: 'Foreclosure',
    description: 'When the debt becomes unserviceable.',
    category: 'special',
    targetType: 'single',
    damage: 45,
    damageType: 'dominion_sight',
    accuracy: 78,
    cooldown: 3,
    currentCooldown: 0,
    staminaCost: 25,
    animation: 'flash_red',
    flavorText: '"Your account is overdue." Dolch steps forward. The chain goes rigid -- no longer a whip but a spear. Every link contracts simultaneously, pulling taut with the force of compound interest. The strike is final. Absolute. Designed to close the books.',
    missText: 'You sidestep the killing blow. Dolch straightens his collar. "Restructuring required."',
    effects: [
      { type: 'bleed', value: 8, duration: 3, chance: 50, description: 'Interest accrual' },
    ],
  },
  {
    id: 'tessurren_audit',
    name: 'Full Audit',
    description: 'Dolch reads every weakness with Sight Dominion.',
    category: 'defend',
    targetType: 'self',
    damage: 0,
    damageType: 'physical',
    accuracy: 100,
    cooldown: 3,
    currentCooldown: 0,
    staminaCost: 12,
    animation: 'sight_flash',
    flavorText: 'Dolch adjusts his cuffs. His eyes sharpen. The Sight Dominion goes surgical -- reading your balance, your weaknesses, the places where the armor of your body and your will are thinnest. "Let me review your portfolio."',
    missText: '',
    effects: [
      { type: 'buff_attack', value: 12, duration: 2, chance: 100, description: 'Liability assessment' },
      { type: 'buff_defense', value: 10, duration: 2, chance: 100, description: 'Hedged position' },
    ],
  },
];

const tessurrenDolch: EnemyTemplate = {
  id: 'tessurren_dolch',
  name: 'Tessurren Dolch',
  title: 'The Squeeze',
  tier: 'commander',
  hp: 126,
  stamina: 90,
  attack: 12,
  defense: 16,
  speed: 28,
  dominion: { iron: 15, sight: 40, king: 10 },
  actions: TESSURREN_ACTIONS,
  aiPattern: 'tactical',
  flavorIntro: 'Thin, precise, smelling of expensive soap. Dolch adjusts the chain around his forearm the way a banker adjusts a cufflink. Each link inscribed with numbers. Each number a debt. "You understand," he says, "this is nothing personal. This is a correction."',
  flavorDefeat: 'Dolch hits the ground. The chain uncoils around him like a dead snake. He looks up with the expression of a man who has just been audited by a force he didn\'t account for. "This... was not in my projections." He\'ll live. But his career at the Kolmari just ended.',
};

export const tessurrenEncounter: CombatEncounter = {
  id: 'boss_tessurren',
  title: 'THE DEBT COLLECTOR',
  subtitle: 'Tessurren Dolch. Every turn he lives costs you Sovereigns.',
  narrativeIntro: [
    'Tessurren Dolch has been polite. Patient. Professional. Three months of contracts, pressure, and gentle reminders that Tavven Shoal belongs to the Kolmari Confederation.',
    'Now the contracts have failed. The polite letters have stopped. The expensive soap still smells the same, but the chain in his hand is no longer decorative.',
    '"Karyudon." He says your name like a line item. "Your account with the Kolmari Confederation is severely overdue. I\'m here to close the books."',
    'The chain uncoils. Each link catches the dock light.',
    '"This will hurt. But understand: it\'s not personal. Debts are gravity. Everyone falls."',
  ],
  narrativeVictory: [
    'Dolch is down. The chain lies scattered across the dock like broken arithmetic. Three months of Kolmari pressure, broken by one afternoon of Oni.',
    'You pick up one of the chain links. Turn it in your fingers. The inscription reads: "Tavven Shoal Municipal Bond, Series 14-C, Principal: 450,000 Sovereigns."',
    'You crush the link in your fist.',
    'The market watches. Hella puts on a fresh pot of tea. Nobody in Tavven Shoal will answer a Kolmari letter for a very long time.',
  ],
  narrativeDefeat: [
    'The chains bind. The debt stacks accumulate. Your Iron can\'t break what you can\'t see, and Dolch\'s Sight reads every gap in your defenses.',
    'But Delvessa steps out of the crowd. She has papers. Counter-filings. Legal instruments that even Dolch can\'t ignore. The fight pauses. The law intervenes. This round goes to the accountants.',
  ],
  enemies: [tessurrenDolch],
  rewards: [
    { type: 'reputation', value: 8, label: '+8 Reputation' },
    { type: 'infamy', value: 5, label: '+5 Infamy' },
    { type: 'sovereigns', value: 150, label: '+150 Sovereigns (seized Kolmari funds)' },
    { type: 'bounty', value: 12000000, label: '+12M Bounty' },
  ],
  defeatConsequence: 'story_continue',
  availableCrew: ['delvessa', 'dragghen', 'kovesse'],
  onVictoryEffects: [
    { type: 'flag', target: 'tessurren_defeated', value: true },
    { type: 'notification', value: true, notification: {
      type: 'grimoire',
      title: 'KOLMARI AGENT DEFEATED AT TAVVEN SHOAL',
      message: 'Tessurren Dolch, senior Kolmari debt recovery specialist, was defeated in direct combat by Karyudon. Kolmari Confederation has issued a formal protest. Local merchants are celebrating. Tea is free at Hella\'s for the rest of the day.',
    }},
  ],
};


// ==========================================
// ISLAND VILLAIN: MAREN KADE - "THE SEAM"
// ==========================================
// Coppervein. Earthquake every 2 turns. Dragghen's
// personal nemesis. The fight that makes him whole.

const MAREN_KADE_ACTIONS: CombatAction[] = [
  {
    id: 'maren_pickaxe_swing',
    name: 'Seam-Splitter',
    description: 'Mining pick, turned weapon. She hits like a cave-in.',
    category: 'strike',
    targetType: 'single',
    damage: 38,
    damageType: 'dominion_iron',
    accuracy: 82,
    cooldown: 0,
    currentCooldown: 0,
    staminaCost: 12,
    animation: 'heavy_smash',
    flavorText: 'Kade swings the pick like she\'s splitting rock. Because to her, you are rock. Iron flows down her arm, through the handle, into the point. The impact craters the ground.',
    missText: 'The pick buries in stone. Kade rips it free without slowing. Miner\'s arm. Thirty years of practice.',
    effects: [
      { type: 'bleed', value: 5, duration: 2, chance: 35, description: 'Shattered stone spray' },
    ],
  },
  {
    id: 'maren_tremor',
    name: 'Tremor',
    description: 'Iron Dominion through the earth. The ground shakes.',
    category: 'dominion',
    targetType: 'all',
    damage: 20,
    damageType: 'dominion_iron',
    accuracy: 100,
    cooldown: 2,
    currentCooldown: 0,
    staminaCost: 20,
    animation: 'screen_shake',
    flavorText: 'Kade slams her foot into the ground. The Iron pulses downward, into bedrock, through fault lines. The earth MOVES. Cracks split the floor. Dust erupts. Everything that isn\'t rooted falls.',
    missText: '',
    effects: [
      { type: 'stun', value: 1, duration: 1, chance: 40, description: 'Knocked off balance' },
    ],
  },
  {
    id: 'maren_cave_in',
    name: 'Cave-In',
    description: 'She brings the ceiling down. On purpose.',
    category: 'special',
    targetType: 'all',
    damage: 35,
    damageType: 'dominion_iron',
    accuracy: 85,
    cooldown: 3,
    currentCooldown: 0,
    staminaCost: 28,
    animation: 'flash_red',
    flavorText: '"I DUG THESE TUNNELS!" Kade raises both fists. The Iron screams through the rock above. Stone fragments rain down. Support beams crack. The mine is becoming a weapon, and Kade doesn\'t care if she\'s inside when it collapses. She survived worse.',
    missText: 'You find a support beam. The stone bounces off your Iron-coated shoulders. Kade spits dust and resets.',
    effects: [
      { type: 'bleed', value: 7, duration: 2, chance: 45, description: 'Falling debris' },
      { type: 'weaken', value: 8, duration: 2, chance: 50, description: 'Buried under rubble' },
    ],
  },
  {
    id: 'maren_iron_wall',
    name: 'Iron Wall',
    description: 'Kade hardens. Thirty years of mine work forged into armor.',
    category: 'defend',
    targetType: 'self',
    damage: 0,
    damageType: 'physical',
    accuracy: 100,
    cooldown: 3,
    currentCooldown: 0,
    staminaCost: 14,
    animation: 'block',
    flavorText: 'Kade crosses her arms. The Iron hardens across her skin, grey and dense, the color of raw Coppervein ore. Her face disappears behind a mask of living metal. "I didn\'t climb out of the mines by being soft."',
    missText: '',
    effects: [
      { type: 'buff_defense', value: 22, duration: 2, chance: 100, description: 'Iron Wall' },
      { type: 'shield', value: 20, duration: 2, chance: 100, description: 'Forged skin' },
    ],
  },
];

const marenKadeBossPhases: BossPhase[] = [
  {
    id: 'maren_phase_2',
    name: 'BEDROCK',
    hpThreshold: 50,
    narration: [
      'Kade staggers. Blood on her lip. She wipes it with the back of her hand and stares at the red on her knuckles.',
      'Then she laughs. It\'s not a nice laugh.',
      '"You think that matters?" She straightens. The Iron around her intensifies, not just coating anymore but GROWING, plates erupting from her skin like geological formations. Her eyes glow behind layers of living metal.',
      '"I was born in a mine. I BECAME the mine." The ground starts shaking. Continuously. It doesn\'t stop.',
    ],
    statChanges: { attack: 7, defense: 8, speed: -4 },
    triggered: false,
  },
];

const marenKade: EnemyTemplate = {
  id: 'maren_kade',
  name: 'Maren Kade',
  title: 'The Seam',
  tier: 'boss',
  hp: 256,
  stamina: 110,
  attack: 22,
  defense: 28,
  speed: 20,
  dominion: { iron: 55, sight: 10, king: 10 },
  actions: MAREN_KADE_ACTIONS,
  aiPattern: 'berserker',
  flavorIntro: 'She\'s waiting at the mine entrance. Arms crossed. Pick in the ground beside her like a planted flag. 6\'4" of Gorundai muscle, hands scarred from three decades of digging. She sees you and sees Dragghen behind you and her expression doesn\'t change. "You brought him. Good. He should see this."',
  flavorDefeat: 'Kade goes down. The tremors stop. The mine goes quiet for the first time in years. She lies in the rubble she created, breathing hard, and looks at Dragghen. Not at you. At him. "You left." "I had to." "I know." She closes her eyes. "The mines are yours. Run them better than I did."',
  bossPhases: marenKadeBossPhases,
};

export const marenKadeEncounter: CombatEncounter = {
  id: 'boss_maren_kade',
  title: 'THE SEAM',
  subtitle: 'Maren Kade. The woman who turned a mine into a kingdom and workers into resources.',
  narrativeIntro: [
    'Coppervein\'s mine shafts echo with the sound of picks hitting rock. Maren Kade built this place. Not the island -- the economy. The hierarchy. The understanding that everything below the surface belongs to her because she bled for it first.',
    'She\'s waiting at the deepest shaft. Where the copper runs thickest. Where the air tastes like metal.',
    'Dragghen stands behind you. His fists are clenched. He worked these mines. He watched forty workers sold as debt labor because Kade needed to make a quarterly payment. He left because staying would have meant becoming her.',
    '"Maren." Dragghen\'s voice echoes.',
    '"Kolve." She doesn\'t turn around. "You came back. Took you long enough."',
    'She picks up the Seam-Splitter. Turns. The Iron radiates off her in waves.',
    '"Let\'s see if your new captain is worth what you gave up."',
  ],
  narrativeVictory: [
    'The mine goes silent. Maren Kade lies in the rubble, and for the first time in thirty years, Coppervein is free of her grip.',
    'Dragghen kneels beside her. Checks her pulse. She\'s alive. He doesn\'t say anything for a long time.',
    'Then: "I\'ll run them better."',
    'She opens one eye. "You\'d better." A pause. "The copper in Shaft 7 runs deeper than my maps show. Follow the green vein. It leads to something." She closes her eye again.',
    'The workers emerge from the shafts. Blinking. Confused. Free. Dragghen looks at them the way a shipwright looks at a hull that needs repair: with care, and with a plan.',
  ],
  narrativeDefeat: [
    'Kade is relentless. The tremors never stop. Every foothold crumbles. Your Iron meets her Iron and hers has thirty years of the mountain behind it.',
    'Dragghen catches you as you fall. His shield takes the blow meant for your head. "Captain. Regroup."',
    'Kade watches you retreat. She doesn\'t pursue. She never has to. She\'ll be here tomorrow. She\'s always been here.',
  ],
  enemies: [marenKade],
  rewards: [
    { type: 'reputation', value: 10, label: '+10 Reputation' },
    { type: 'materials', value: 60, label: '+60 Materials (Coppervein ore access)' },
    { type: 'bounty', value: 18000000, label: '+18M Bounty' },
    { type: 'sovereigns', value: 250, label: '+250 Sovereigns (mining revenue)' },
  ],
  defeatConsequence: 'retreat',
  availableCrew: ['dragghen', 'vorreth', 'suulen', 'delvessa', 'kovesse', 'tessek', 'orren'],
  onVictoryEffects: [
    { type: 'flag', target: 'maren_kade_defeated', value: true },
    { type: 'loyalty', target: 'dragghen', value: 20 },
  ],
};


// ==========================================
// ISLAND VILLAIN: CAPTAIN HULL - "THE BARNACLE"
// ==========================================
// Mossbreak. Highest DEF in the game.
// Tortoise shell at 50%. Endurance test.
// Loveable grumpy grandpa.

const CAPTAIN_HULL_ACTIONS: CombatAction[] = [
  {
    id: 'hull_cannon_arm',
    name: 'Arm Cannon',
    description: 'The prosthetic arm IS the weapon.',
    category: 'strike',
    targetType: 'single',
    damage: 35,
    damageType: 'physical',
    accuracy: 78,
    cooldown: 1,
    currentCooldown: 0,
    staminaCost: 14,
    animation: 'heavy_smash',
    flavorText: 'The prosthetic arm clicks. Reconfigures. The barrel extends and the blast shakes the beach. Hull built this arm himself. It fires Craft-grade Resonance bolts and doesn\'t have a safety mechanism because "safeties are for people who miss."',
    missText: 'The shot goes wide. Hull swears. "Calibration\'s off. Hold still, kid."',
    effects: [
      { type: 'stun', value: 1, duration: 1, chance: 25, description: 'Concussive blast' },
    ],
  },
  {
    id: 'hull_leg_blade',
    name: 'Leg Blade',
    description: 'The prosthetic leg has a surprise.',
    category: 'strike',
    targetType: 'single',
    damage: 28,
    damageType: 'physical',
    accuracy: 85,
    cooldown: 2,
    currentCooldown: 0,
    staminaCost: 10,
    animation: 'counter',
    flavorText: 'Hull pivots. The prosthetic leg extends a blade from the shin, three feet of hidden steel. The kick is surprisingly fast for a seventy-year-old on one real leg. "NOBODY expects the leg blade."',
    missText: 'You jump the sweep. Hull grins. "Quick kid. I like that."',
    effects: [
      { type: 'bleed', value: 6, duration: 2, chance: 40, description: 'Shin cut' },
    ],
  },
  {
    id: 'hull_tortoise',
    name: 'Tortoise Shell',
    description: 'God Fruit ability. Near-indestructible defense.',
    category: 'defend',
    targetType: 'self',
    damage: 0,
    damageType: 'physical',
    accuracy: 100,
    cooldown: 3,
    currentCooldown: 0,
    staminaCost: 20,
    animation: 'block',
    flavorText: 'Hull hunches. His skin darkens, thickens, hardens. A shell forms across his back, shoulders, and arms. Green-brown plates, each one harder than stone. The Tortoise Fruit. Forty years of practice. "Hit me. I\'ll wait."',
    missText: '',
    effects: [
      { type: 'buff_defense', value: 40, duration: 3, chance: 100, description: 'Tortoise Shell' },
      { type: 'shield', value: 30, duration: 3, chance: 100, description: 'Shell plating' },
    ],
  },
  {
    id: 'hull_old_tricks',
    name: 'Old Pirate\'s Tricks',
    description: 'Forty years of dirty fighting.',
    category: 'strike',
    targetType: 'single',
    damage: 20,
    damageType: 'physical',
    accuracy: 92,
    cooldown: 2,
    currentCooldown: 0,
    staminaCost: 8,
    animation: 'flash_white',
    flavorText: 'Sand in the eyes. Salt in the wound. A headbutt from a man whose skull has been reinforced by four decades of Tortoise Fruit. "Fair fights are for people with all their limbs, kid."',
    missText: 'You see it coming. Hull shrugs. "Worth a try."',
    effects: [
      { type: 'weaken', value: 10, duration: 1, chance: 60, description: 'Blinded' },
      { type: 'expose', value: 8, duration: 1, chance: 40, description: 'Off-balance' },
    ],
  },
];

const hullBossPhases: BossPhase[] = [
  {
    id: 'hull_phase_2',
    name: 'LAST STAND OF THE BARNACLE',
    hpThreshold: 50,
    narration: [
      'Hull spits blood. Wipes his mouth. His one good eye studies you with something you haven\'t seen from him yet.',
      'Respect.',
      '"Alright, kid. You earned it." He sets his feet. The Tortoise Fruit activates fully, not the partial shell he\'s been using. FULL transformation. His entire body hardens. Every inch of skin becomes shell. Even his eye goes dark behind a translucent plate.',
      '"Been on this island forty years. Nobody\'s pushed me this far." The prosthetic arm whirs. "Let\'s see if you can finish what you started."',
    ],
    statChanges: { defense: 15, attack: 4, speed: -6 },
    triggered: false,
  },
];

const captainHull: EnemyTemplate = {
  id: 'captain_hull',
  name: 'Captain Hull',
  title: 'The Barnacle',
  tier: 'boss',
  hp: 280,
  stamina: 100,
  attack: 20,
  defense: 35,
  speed: 16,
  dominion: { iron: 30, sight: 15, king: 10 },
  actions: CAPTAIN_HULL_ACTIONS,
  aiPattern: 'defensive',
  flavorIntro: 'He\'s sitting on a rock. Missing one arm (brass prosthetic), missing one leg (iron prosthetic), and missing zero attitude. Captain Hull. Seventy-two years old. Been on Mossbreak longer than most trees. He sees you and doesn\'t stand up. "Another one. They send \'em younger every decade." He takes a pull from a flask. "Alright, kid. Let\'s get this over with."',
  flavorDefeat: 'Hull sits down. Not because he wants to. Because his legs finally give out. The Tortoise shell recedes. Underneath: an old man, bleeding, breathing hard, one eye bright. He looks at you and LAUGHS. "Forty years. Nobody could do that. Not the Wardensea, not the Kolmari, not a damn hurricane." He extends his good hand. "The island\'s yours, kid. You earned it. Now come have a drink. I\'ve got stories."',
  bossPhases: hullBossPhases,
};

export const captainHullEncounter: CombatEncounter = {
  id: 'boss_captain_hull',
  title: 'THE BARNACLE',
  subtitle: 'Captain Hull. Forty years on Mossbreak. Nobody has moved him.',
  narrativeIntro: [
    'Mossbreak is old. Old in a way that seeps into the rocks. And Hull is older, or at least it feels that way. He\'s been sitting on this island since before you were born, and he has no intention of leaving.',
    '"I was here first," he says. "That\'s all the law there is."',
    'He stands. The prosthetics click and hiss. The cannon arm rotates to face you. The leg blade extends half an inch, a warning, not a threat.',
    '"I like you, kid. You\'ve got good horns. Reminds me of a fella I fought once up near Durrek. But this island\'s mine. I bled for it. I built on it. And if you want it..."',
    'He raises his fists. The Tortoise shell ripples across his back.',
    '"...you\'re gonna have to earn it."',
  ],
  narrativeVictory: [
    'Hull sits on his rock again. This time because you put him there. But he\'s smiling. He\'s SMILING.',
    '"That\'s the good stuff, kid. That\'s the real thing." He opens a fresh flask. "The island\'s yours. I\'ll be around. Old pirates don\'t disappear. We just barnacle onto the next ship."',
    'He looks at Mossbreak with forty years of memories in his eye.',
    '"Take care of it. The moss on the north ridge blooms in spring. It\'s worth seeing."',
    'You sit next to him. Take the flask. The rum is terrible.',
    'The view is not.',
  ],
  narrativeDefeat: [
    'The Tortoise shell is too thick. Your attacks bounce. Hull isn\'t fast but he doesn\'t need to be. He stands his ground and lets you exhaust yourself against a wall that doesn\'t break.',
    '"Come back when you\'ve eaten a few more meals, kid." He sits back down. "I\'ll be here. I\'m always here."',
  ],
  enemies: [captainHull],
  rewards: [
    { type: 'supplies', value: 40, label: '+40 Supplies (Mossbreak stores)' },
    { type: 'reputation', value: 8, label: '+8 Reputation' },
    { type: 'bounty', value: 10000000, label: '+10M Bounty' },
    { type: 'sovereigns', value: 150, label: '+150 Sovereigns' },
  ],
  defeatConsequence: 'retreat',
  availableCrew: ['dragghen', 'vorreth', 'suulen', 'delvessa', 'kovesse', 'tessek', 'orren'],
  onVictoryEffects: [
    { type: 'flag', target: 'captain_hull_defeated', value: true },
    { type: 'notification', value: true, notification: {
      type: 'grimoire',
      title: 'THE BARNACLE FALLS',
      message: 'Captain Hull, forty-year ruler of Mossbreak, was defeated by Karyudon in single combat. Hull is alive and reportedly "delighted." Mossbreak changes hands for the first time in four decades. The old pirate was seen sharing a drink with his conqueror afterward.',
    }},
  ],
};


// ==========================================
// ISLAND VILLAIN: SABLE VENN - "THE AUCTION"
// ==========================================
// The Rival. Personal enemy. Every turn he
// generates Sovereign pressure. A mirror fight.

const SABLE_VENN_ACTIONS: CombatAction[] = [
  {
    id: 'sable_sold',
    name: 'Sold',
    description: 'The 40-pound gavel hits like a verdict.',
    category: 'strike',
    targetType: 'single',
    damage: 35,
    damageType: 'physical',
    accuracy: 82,
    cooldown: 0,
    currentCooldown: 0,
    staminaCost: 14,
    animation: 'heavy_smash',
    flavorText: 'Sable brings the gavel down. Sold. Forty pounds of Craft-grade iron shaped like justice and swung like a wrecking ball. The impact rings like an auction bell. "Going once."',
    missText: '"Going... nowhere." Sable resets. The gold eye calculates. The glass eye stares.',
  },
  {
    id: 'sable_hostile_takeover',
    name: 'Hostile Takeover',
    description: 'Sight Dominion reads your entire position. King Dominion pressures.',
    category: 'dominion',
    targetType: 'single',
    damage: 40,
    damageType: 'dominion_sight',
    accuracy: 84,
    cooldown: 2,
    currentCooldown: 0,
    staminaCost: 22,
    animation: 'sight_flash',
    flavorText: 'Sable\'s gold eye glows. He sees your position, your openings, the exact angle that will cost you the most to defend against. Then the King Dominion hits: not physical force but FINANCIAL pressure, the specific anxiety of a bad deal closing around you. Your body hesitates. The gavel doesn\'t.',
    missText: 'You push through the pressure. Sable blinks. "Impressive. Most people freeze when the deal goes bad."',
    effects: [
      { type: 'intimidate', value: 8, duration: 2, chance: 50, description: 'Market pressure' },
      { type: 'expose', value: 10, duration: 2, chance: 40, description: 'Position exposed' },
    ],
  },
  {
    id: 'sable_buyout',
    name: 'Buyout Offer',
    description: 'King Dominion. An offer you want to accept.',
    category: 'dominion',
    targetType: 'all',
    damage: 25,
    damageType: 'dominion_king',
    accuracy: 80,
    cooldown: 3,
    currentCooldown: 0,
    staminaCost: 25,
    animation: 'king_pressure',
    flavorText: '"I\'ll make this simple." Sable\'s King Dominion radiates outward. Not the crushing force of raw will but something subtler -- the feeling of surrender being reasonable. Of compromise being smart. Of just... giving up. Your crew shifts. Even Vorreth tenses.',
    missText: 'You plant your feet. "No deal." Sable\'s smile cracks. Just for a second.',
    effects: [
      { type: 'weaken', value: 10, duration: 2, chance: 55, description: 'Tempting offer' },
      { type: 'intimidate', value: 10, duration: 2, chance: 45, description: 'Why fight when you can deal?' },
    ],
  },
  {
    id: 'sable_hedge',
    name: 'Hedged Position',
    description: 'Sable doesn\'t take risks. He manages them.',
    category: 'defend',
    targetType: 'self',
    damage: 0,
    damageType: 'physical',
    accuracy: 100,
    cooldown: 3,
    currentCooldown: 0,
    staminaCost: 12,
    animation: 'block',
    flavorText: 'Sable steps back. The gavel comes up in a guard position. His Sight reads every angle of attack and his body adjusts accordingly. He fights like a portfolio: diversified, insured, and designed to survive any market condition.',
    missText: '',
    effects: [
      { type: 'buff_defense', value: 18, duration: 2, chance: 100, description: 'Hedged' },
      { type: 'heal', value: 15, duration: 1, chance: 100, description: 'Position recovery' },
    ],
  },
];

const sableVennBossPhases: BossPhase[] = [
  {
    id: 'sable_phase_2',
    name: 'ALL IN',
    hpThreshold: 40,
    narration: [
      'Sable stumbles. Blood on his coat. On his rings. On Sold.',
      'The gold eye is wide. The glass eye, as always, sees nothing.',
      'For the first time since you\'ve known him, Sable Venn looks unsure. Not of the fight. Of himself. Of whether money really can buy everything. Of whether the Oni standing in front of him has something he can\'t purchase.',
      '"Fine." He pulls off his coat. Underneath: lean muscle, a body that trained for this even if it prefers not to. The rings come off. One by one. Each one clinks on the dock.',
      '"No more offers. No more deals. Just you and me." The gavel rises. His King Dominion flares, raw this time, not the polished persuasion of a broker but the desperate will of a man who refuses to lose.',
      '"Let\'s find out what I\'m worth."',
    ],
    statChanges: { attack: 8, speed: 6, defense: -5 },
    triggered: false,
  },
];

const sableVenn: EnemyTemplate = {
  id: 'sable_venn',
  name: 'Sable Venn',
  title: 'The Auction',
  tier: 'boss',
  hp: 224,
  stamina: 120,
  attack: 21,
  defense: 22,
  speed: 26,
  dominion: { iron: 25, sight: 55, king: 35 },
  actions: SABLE_VENN_ACTIONS,
  aiPattern: 'tactical',
  flavorIntro: 'He\'s waiting at the dock. White hair slicked back, gold eye catching the sun. The Final Offer bobs behind him. He looks like he\'s about to close a deal. He is. The deal involves a forty-pound gavel. "Karyudon. I was hoping we could resolve this with numbers." He lifts Sold. "These are the only numbers I have left."',
  flavorDefeat: 'Sable hits the dock. The gavel rolls away. He lies there, bleeding, staring at the sky, and starts laughing. "Nine hundred million Sovereigns," he says. "And I couldn\'t buy what you have." He looks at you. The gold eye. The glass eye. "People who follow you for free. How do you DO that?" He doesn\'t expect an answer. He already knows. That\'s what makes it hurt.',
  bossPhases: sableVennBossPhases,
};

const rikkartBolm: EnemyTemplate = {
  id: 'rikkart_bolm',
  name: 'Rikkart Bolm',
  title: 'The Margin',
  tier: 'elite',
  hp: 140,
  stamina: 80,
  attack: 18,
  defense: 22,
  speed: 18,
  dominion: { iron: 40, sight: 5, king: 0 },
  actions: [
    {
      id: 'rikkart_collection',
      name: 'Collection',
      description: 'Eight feet of Gorundai. No discussion necessary.',
      category: 'strike',
      targetType: 'single',
      damage: 38,
      damageType: 'dominion_iron',
      accuracy: 80,
      cooldown: 0,
      currentCooldown: 0,
      staminaCost: 12,
      animation: 'heavy_smash',
      flavorText: 'Rikkart hits you the way a debt hits a budget: unavoidable, structural, and designed to change your plans for the foreseeable future.',
      missText: 'You dodge the swing. Rikkart doesn\'t seem frustrated. He doesn\'t seem anything. He resets.',
    },
    {
      id: 'rikkart_bodyguard',
      name: 'Bodyguard Stance',
      description: 'He stands between you and Sable.',
      category: 'defend',
      targetType: 'self',
      damage: 0,
      damageType: 'physical',
      accuracy: 100,
      cooldown: 2,
      currentCooldown: 0,
      staminaCost: 8,
      animation: 'block',
      flavorText: 'Rikkart shifts to cover Sable. The suit strains at the shoulders. He\'s been doing this for years. The job description is simple: stand between the money and the problem.',
      missText: '',
      effects: [
        { type: 'buff_defense', value: 20, duration: 2, chance: 100, description: 'Bodyguard stance' },
      ],
    },
  ],
  aiPattern: 'defensive',
  flavorIntro: 'Eight feet. Suit. No expression. Rikkart Bolm. The Margin. The negotiation you have when negotiation has failed.',
  flavorDefeat: 'Rikkart falls. The suit rips at the shoulder. He looks at Sable. Sable doesn\'t look back. That tells you everything about the Closing Bid.',
};

export const sableVennEncounter: CombatEncounter = {
  id: 'rival_sable_venn',
  title: 'THE AUCTION CLOSES',
  subtitle: 'Sable Venn. Nine hundred million Sovereigns. And it wasn\'t enough.',
  narrativeIntro: [
    'He tried buying your trade routes. He tried buying your crew. He tried buying the island out from under you. None of it worked.',
    'Now Sable Venn stands at the end of Tavven Shoal\'s longest dock with his gavel in his hand and his crew at his back and his empire of purchased loyalty behind him, and he is going to find out what happens when money meets will.',
    '"I offered you everything," he says. "Partnership. Profit-sharing. A seat at the table where real decisions get made." He lifts Sold. "You chose this instead."',
    '"I chose this."',
    '"Then let\'s see what your conviction buys you."',
  ],
  narrativeVictory: [
    'The Closing Bid is done. Rikkart is down. The twins fled the moment it turned. Sable lies on the dock with nine hundred million Sovereigns\' worth of nothing.',
    'You stand over him. The Danzai is heavy in your hand.',
    '"You asked how I do it," you say. "How people follow me for free." You offer your hand. "I don\'t buy them. I fight beside them."',
    'Sable looks at your hand. The gold eye. The glass eye. For a long time, he doesn\'t move.',
    'Then he takes it.',
    '"I want a rematch," he says. "But first, I want a drink."',
    'Kovesse is already broadcasting: "Ladies and gentlemen. The Auction is CLOSED."',
  ],
  narrativeDefeat: [
    'Sable is smarter than you expected. The Sight reads everything. The King pressure makes your crew hesitate. And Rikkart... Rikkart hits like a collapsing building.',
    'You go down. Sable stands over you. The gold eye is sad. Genuinely sad.',
    '"I didn\'t want this." He turns away. "Send me an offer. We\'ll restructure."',
  ],
  enemies: [sableVenn, rikkartBolm],
  rewards: [
    { type: 'reputation', value: 12, label: '+12 Reputation' },
    { type: 'infamy', value: 8, label: '+8 Infamy' },
    { type: 'bounty', value: 25000000, label: '+25M Bounty' },
    { type: 'sovereigns', value: 400, label: '+400 Sovereigns (Sable\'s "donation")' },
    { type: 'intelligence', value: 15, label: '+15 Intelligence (Closing Bid operations)' },
  ],
  defeatConsequence: 'retreat',
  availableCrew: ['dragghen', 'vorreth', 'suulen', 'delvessa', 'kovesse', 'tessek', 'orren'],
  onVictoryEffects: [
    { type: 'flag', target: 'sable_venn_defeated', value: true },
    { type: 'notification', value: true, notification: {
      type: 'grimoire',
      title: 'GRIMOIRE BREAKING - THE AUCTION IS CLOSED',
      message: 'Sable Venn, The Auction, former Kolmari investment broker and rival claimant to multiple Bastion Sea territories, was defeated in combat by Karyudon. Venn\'s crew, The Closing Bid, has reportedly disbanded. The Final Offer was last seen leaving Tavven Shoal harbor. Venn himself was seen sharing a drink with his conqueror. The Bastion Sea is down to one contender.',
    }},
  ],
};


// ==========================================
// KIRIN AKKAN - "THE PRODIGAL"
// ==========================================
// MC's brother. Betrayed him on the uncle's orders.
// Now here, broken, carrying guilt like a second skeleton.
// The fight mechanic: Blood Debt. He hesitates every 3 turns.
// Phase 2: the uncle's conditioning overrides the guilt.

const KIRIN_ACTIONS: CombatAction[] = [
  {
    id: 'kirin_highland_iron',
    name: 'Highland Iron',
    description: 'Mountain-trained Iron technique. Raw. Powerful. No academy polish.',
    category: 'strike',
    targetType: 'single',
    damage: 38,
    damageType: 'dominion_iron',
    accuracy: 84,
    cooldown: 0,
    currentCooldown: 0,
    staminaCost: 12,
    animation: 'iron_pulse',
    flavorText: 'Kirin lunges. No form. No technique. Just highland Iron, the kind you forge in mountain air against rock and wind, driven by something deeper than training. He fights the way you taught him to fight. The irony is not lost.',
    missText: 'You sidestep. His fist cracks the deck where you stood. He\'s breathing hard. Not from exertion. From something else.',
    effects: [
      { type: 'bleed', value: 5, duration: 2, chance: 30, description: 'Highland impact' },
    ],
  },
  {
    id: 'kirin_guilt_strike',
    name: 'Desperate Blow',
    description: 'Overextended. Emotional. Hits hard but leaves him open.',
    category: 'strike',
    targetType: 'single',
    damage: 48,
    damageType: 'dominion_iron',
    accuracy: 72,
    cooldown: 2,
    currentCooldown: 0,
    staminaCost: 18,
    animation: 'heavy_smash',
    flavorText: 'The swing is wide. Too wide. He\'s not aiming at you. He\'s aiming at the space between what he did and what he should have done. The Iron behind it is real, raw, uncontrolled. This is a man fighting himself more than you.',
    missText: 'He overextends. His guard drops. His eyes say he wanted you to punish that. Wanted you to make this cost.',
    effects: [
      { type: 'expose', value: 10, duration: 2, chance: 60, description: 'Overextended (guilt)' },
    ],
  },
  {
    id: 'kirin_mountain_guard',
    name: 'Mountain Guard',
    description: 'Highland defensive stance. Rock-solid. Familiar.',
    category: 'defend',
    targetType: 'self',
    damage: 0,
    damageType: 'physical',
    accuracy: 100,
    cooldown: 3,
    currentCooldown: 0,
    staminaCost: 8,
    animation: 'block',
    flavorText: 'Kirin drops into Mountain Guard. Feet wide. Arms up. Iron across the torso. You recognize it immediately. You taught him this stance when he was twelve. He hasn\'t changed a thing.',
    missText: '',
    effects: [
      { type: 'buff_defense', value: 20, duration: 2, chance: 100, description: 'Mountain Guard' },
      { type: 'heal', value: 15, duration: 1, chance: 100, description: 'Breathing room' },
    ],
  },
  {
    id: 'kirin_brothers_weight',
    name: 'Brother\'s Weight',
    description: 'Everything he owes compressed into one strike.',
    category: 'special',
    targetType: 'single',
    damage: 55,
    damageType: 'dominion_iron',
    accuracy: 80,
    cooldown: 3,
    currentCooldown: 0,
    staminaCost: 25,
    animation: 'flash_red',
    flavorText: 'Kirin\'s eyes go bright. The Iron-band tattoos on his forearms blaze. Not the uncle\'s pattern. His. The real Iron, the one underneath the conditioning, surfaces for one devastating moment. The punch carries the weight of every night he spent awake wondering if you were alive.',
    missText: 'You catch his fist. Your hand around his. Amber eyes meeting amber eyes. He pulls away. Resets. Shaking.',
    effects: [
      { type: 'bleed', value: 8, duration: 2, chance: 45, description: 'Bone-deep impact' },
      { type: 'weaken', value: 8, duration: 2, chance: 35, description: 'Emotional resonance' },
    ],
  },
];

const KIRIN_PHASE_2_ACTIONS: CombatAction[] = [
  {
    id: 'kirin_highland_shatter',
    name: 'Highland Shatter',
    description: 'The uncle\'s Iron manifests through Kirin. A technique that was never his.',
    category: 'special',
    targetType: 'all',
    damage: 70,
    damageType: 'dominion_iron',
    accuracy: 78,
    cooldown: 3,
    currentCooldown: 0,
    staminaCost: 30,
    animation: 'screen_shake',
    flavorText: 'Kirin\'s hands move in patterns he didn\'t learn. The Iron-band tattoos glow white. The uncle\'s voice, faint, distant, echoes from somewhere inside Kirin\'s throat: "Break him." Kirin slams both fists into the deck. The shockwave shatters planking in a ten-foot radius. Highland technique, old clan warfare, designed to destroy terrain and anyone standing on it.',
    missText: 'The deck explodes around you. You ride the shockwave, airborne for a second. Kirin looks at his own hands with someone else\'s expression.',
    effects: [
      { type: 'stun', value: 1, duration: 1, chance: 45, description: 'Shockwave' },
      { type: 'expose', value: 12, duration: 2, chance: 50, description: 'Terrain destruction' },
    ],
  },
  {
    id: 'kirin_puppet_rush',
    name: 'Puppet Rush',
    description: 'Kirin moves without choosing to. The uncle pulls the strings.',
    category: 'strike',
    targetType: 'single',
    damage: 52,
    damageType: 'dominion_iron',
    accuracy: 88,
    cooldown: 2,
    currentCooldown: 0,
    staminaCost: 20,
    animation: 'iron_pulse',
    flavorText: 'Kirin\'s body moves. Three steps, a pivot, an elbow strike into an uppercut. Perfect form. Not his form. The uncle trained dozens of Iron users, and his techniques are burned into those tattoos like instructions in a machine. Kirin\'s eyes are vacant. His body performs.',
    missText: 'You block. Kirin\'s eyes focus for half a second. His mouth forms a word: "Sorry." Then the vacancy returns.',
    effects: [
      { type: 'bleed', value: 6, duration: 2, chance: 40, description: 'Precision strike (uncle\'s technique)' },
    ],
  },
];

const kirinBossPhases: BossPhase[] = [
  {
    id: 'kirin_phase_2',
    name: 'THE UNCLE\'S VOICE',
    hpThreshold: 40,
    narration: [
      'Kirin drops to one knee. Blood from his lip. Iron flickering on his skin.',
      'Then the tattoos activate.',
      'Both forearms light up, white, hot, pulsing in a rhythm that isn\'t Kirin\'s heartbeat. His pupils constrict to points. His hands stop shaking. His breathing becomes mechanical. Regular. Controlled by something external.',
      'When he speaks, it\'s his mouth but not his voice. Deeper. Older. The measured cadence of a man who has spent decades learning how to make other people into instruments.',
      '"Did you think I\'d send him uninsured?"',
      'Uncle Tessok\'s Iron, channeled through the band tattoos, overrides Kirin\'s hesitation. Your brother stands. His movements are wrong: too smooth, too precise, too unlike the raw highland fighter who was losing to guilt.',
      'The puppet fights harder than the person.',
    ],
    statChanges: { attack: 11, speed: 8, defense: -8 },
    newActions: KIRIN_PHASE_2_ACTIONS,
    aiPatternChange: 'aggressive',
    triggered: false,
  },
];

const kirinAkkan: EnemyTemplate = {
  id: 'kirin_akkan',
  name: 'Kirin',
  title: 'The Prodigal',
  tier: 'boss',
  portrait: 'kirin_akkan',
  hp: 256,
  stamina: 140,
  attack: 28,
  defense: 22,
  speed: 28,
  dominion: { iron: 65, sight: 15, king: 30 },
  actions: KIRIN_ACTIONS,
  aiPattern: 'berserker',
  flavorIntro: 'Kirin steps onto the dock. He doesn\'t draw a weapon because he doesn\'t carry one. Highland Oni fight with their hands and their Iron. Always have. He looks at you with amber eyes that match yours and takes a breath that shakes on the way in. "I\'m sorry," he says. Then his Iron activates, and talking is over.',
  flavorDefeat: 'Kirin hits the deck. The Iron-band tattoos flicker and die. The uncle\'s presence, the subtle wrongness behind his eyes, evaporates like steam off hot metal. What\'s left is just a young man, bleeding on wooden planks, looking up at his older brother with eyes that are finally, entirely his own. "I\'m sorry. I\'m so sorry." He doesn\'t try to get up. He waits for whatever comes next.',
  bossPhases: kirinBossPhases,
};

export const kirinEncounter: CombatEncounter = {
  id: 'kirin_boss_fight',
  title: 'THE HIGHLAND DEBT',
  subtitle: 'Your brother. Your blood. Your fight.',
  background: 'combat_bg_kirin',
  narrativeIntro: [
    'The dock is empty. Vorreth cleared it twenty minutes ago with a look and a word to the harbor master. Your crew stands at the rail of your ship, watching. Delvessa\'s hand is on the gangway rope, ready to drop it if you need backup.',
    'You don\'t need backup. This isn\'t that kind of fight.',
    'Kirin stands forty feet away. His ship behind him. Your ship behind you. The Bastion Sea on both sides, indifferent, the way oceans are to the problems of the people floating on them.',
    '"You don\'t have to do this." Kirin\'s voice carries across the empty dock. "I\'ll leave. I\'ll find another way to get the twins."',
    'You crack your knuckles. The Iron flows. Charcoal-black over esmer skin.',
    '"There is no other way. There\'s only through."',
    'Kirin closes his eyes. Opens them. The amber ignites with Iron.',
    '"Through, then."',
  ],
  narrativeVictory: [
    'Kirin is on the ground. The Iron-band tattoos are dark. His breathing is ragged but steady. Blood on the dock, his and yours, pooling together because that\'s what blood from the same family does.',
    'You stand over him. Danzai in hand. The crew is silent.',
    'Kirin looks up at you. His eyes are clear. Whatever the uncle was broadcasting through those tattoos, you beat it out of him. The real Kirin, the one who used to follow you up the mountain before dawn to watch the sun hit the highlands, is looking at you from behind a face that\'s been through too much.',
    '"The compound," he says. His voice is his own again. Hoarse. Small. "I know everything. Guard rotations. Iron tiers. The weak points in the eastern wall."',
    'He swallows.',
    '"Let me help. Not because I deserve to. Because they deserve to come home."',
    'You sheathe the Danzai.',
    'You extend your hand.',
  ],
  narrativeDefeat: [
    'Kirin is stronger than he looks. The uncle\'s conditioning adds layers of technique that shouldn\'t stack on top of raw highland Iron, but they do. You go down.',
    'Kirin stands over you. Crying. His fists are still clenched but his body language says he\'d rather be anywhere else in the world.',
    '"I\'m sorry." He says it three times. Then he turns and walks back to his ship.',
    'Delvessa drops the gangway. The crew floods the dock. Kovesse is broadcasting your vitals on three frequencies. Dragghen is running calculations on how badly you\'re broken.',
    'But Kirin didn\'t finish you. He pulled every hit he landed after you went down. The uncle\'s conditioning wanted a kill. Kirin gave it a win instead.',
    'That counts for something. You\'re not sure what yet.',
  ],
  enemies: [kirinAkkan],
  rewards: [
    { type: 'reputation', value: 8, label: '+8 Reputation' },
    { type: 'intelligence', value: 30, label: '+30 Intelligence (Highland compound data from Kirin)' },
    { type: 'flag', value: true, target: 'kirin_defeated', label: 'Kirin defeated' },
    { type: 'flag', value: true, target: 'kirin_alive', label: 'Kirin survived' },
  ],
  defeatConsequence: 'story_continue',
  availableCrew: ['dragghen', 'vorreth', 'suulen', 'delvessa', 'kovesse'],
  specialConditions: ['Kirin hesitates every 3 turns (skips action). Phase 2 removes hesitation.'],
  onVictoryEffects: [
    { type: 'flag', target: 'kirin_defeated', value: true },
    { type: 'flag', target: 'kirin_alive', value: true },
    { type: 'notification', value: true, notification: {
      type: 'story',
      title: 'THE HIGHLAND DEBT - PAID',
      message: 'You beat your brother. Not to death. To sense. The uncle\'s conditioning is broken. Kirin is offering everything he knows about the compound. The twins might have a chance.',
    }},
  ],
  onDefeatEffects: [
    { type: 'flag', target: 'kirin_encounter_lost', value: true },
    { type: 'flag', target: 'kirin_alive', value: true },
  ],
};


// ==========================================
// PRIME EDARA KHOSS - "THE QUIET STORM"
// ==========================================
// Endgame Wardensea boss. Third Prime.
// Assigned to Bastion Sea after Vasshen's defeat.
// Hardest fight in the game. Three phases.
// She fights like an institution, not a person.

const PRIME_KHOSS_ACTIONS: CombatAction[] = [
  {
    id: 'khoss_storm_blade',
    name: 'Storm Blade',
    description: 'Iron Dominion channeled with thirty years of field command. Every cut is a policy decision.',
    category: 'strike',
    targetType: 'single',
    damage: 50,
    damageType: 'dominion_iron',
    accuracy: 90,
    cooldown: 0,
    currentCooldown: 0,
    staminaCost: 14,
    animation: 'iron_pulse',
    flavorText: 'Khoss moves without announcing it. One moment she\'s standing. The next, the blade is completing a cut that started somewhere you couldn\'t see. Her Iron is different from Vasshen\'s: not institutional discipline but atmospheric pressure. The air gets heavier when she swings.',
    missText: 'You dodge. She doesn\'t react. Doesn\'t adjust. Just resets and waits. She has the patience of weather.',
    effects: [
      { type: 'bleed', value: 7, duration: 2, chance: 40, description: 'Precision cut' },
    ],
  },
  {
    id: 'khoss_division_anchor',
    name: 'Division Anchor',
    description: 'The Prime plants her authority. The ground itself becomes Wardensea territory.',
    category: 'defend',
    targetType: 'self',
    damage: 0,
    damageType: 'physical',
    accuracy: 100,
    cooldown: 3,
    currentCooldown: 0,
    staminaCost: 16,
    animation: 'king_pressure',
    flavorText: 'Khoss drives her blade into the deck. Iron radiates outward in concentric rings. The wood hardens. The air stills. For a radius of twenty feet, this is no longer a ship. It\'s a garrison. Her garrison. She fights better on ground she\'s claimed.',
    missText: '',
    effects: [
      { type: 'buff_defense', value: 25, duration: 2, chance: 100, description: 'Division anchor' },
      { type: 'buff_attack', value: 10, duration: 2, chance: 100, description: 'Fortified position' },
      { type: 'heal', value: 30, duration: 1, chance: 100, description: 'Institutional recovery' },
    ],
  },
  {
    id: 'khoss_prime_judgment',
    name: 'Prime\'s Judgment',
    description: 'When a Prime passes sentence, the sentence is Iron.',
    category: 'dominion',
    targetType: 'single',
    damage: 65,
    damageType: 'dominion_iron',
    accuracy: 84,
    cooldown: 2,
    currentCooldown: 0,
    staminaCost: 24,
    animation: 'flash_red',
    flavorText: 'Khoss raises her blade. The Iron around it isn\'t a glow. It\'s a field. The air warps. Light bends. The temperature drops five degrees. She brings the blade down with the combined weight of thirty years, four commands, two wars, and the absolute conviction that she is right. The deck cracks. The sound reaches the shore.',
    missText: 'You dodge the judgment but not the pressure wave. Your feet leave the deck. You land hard. She\'s already resetting. Patient as a storm front.',
    effects: [
      { type: 'stun', value: 1, duration: 1, chance: 45, description: 'Iron concussion wave' },
      { type: 'weaken', value: 12, duration: 2, chance: 55, description: 'Dominion suppression field' },
    ],
  },
  {
    id: 'khoss_tactical_assessment',
    name: 'Tactical Assessment',
    description: 'Khoss reads the battlefield. Adjusts. Adapts. The Wardensea learns.',
    category: 'defend',
    targetType: 'self',
    damage: 0,
    damageType: 'physical',
    accuracy: 100,
    cooldown: 4,
    currentCooldown: 0,
    staminaCost: 10,
    animation: 'sight_flash',
    flavorText: 'Khoss steps back. Studies you. Her Sight isn\'t flashy: no glowing eyes, no dramatic reveals. She just watches. The way a general watches a map. By the time she moves again, she knows three things about you that you didn\'t know about yourself.',
    missText: '',
    effects: [
      { type: 'buff_attack', value: 15, duration: 3, chance: 100, description: 'Tactical read' },
      { type: 'buff_defense', value: 8, duration: 3, chance: 100, description: 'Adjusted stance' },
    ],
  },
  {
    id: 'khoss_execute_protocol',
    name: 'Execute Protocol',
    description: 'Lethal force. No appeals. No restraint.',
    category: 'special',
    targetType: 'single',
    damage: 80,
    damageType: 'dominion_iron',
    accuracy: 80,
    cooldown: 4,
    currentCooldown: 0,
    staminaCost: 35,
    animation: 'flash_red',
    flavorText: '"Lethal force." Two words. Quiet. The blade ignites with Iron so dense it turns black. Not the grey of standard Wardensea steel. Black. The Iron of someone who has killed enough people to stop counting and started again. The cut is fast enough that the sound arrives after the impact.',
    missText: 'You feel the blade pass through the space where your head was. The air parts and doesn\'t close for two full seconds. That was inches. Maybe less.',
    effects: [
      { type: 'bleed', value: 12, duration: 3, chance: 60, description: 'Execution wound' },
      { type: 'expose', value: 15, duration: 2, chance: 50, description: 'Guard demolished' },
    ],
  },
];

const PRIME_KHOSS_PHASE_2_ACTIONS: CombatAction[] = [
  {
    id: 'khoss_storm_field',
    name: 'Storm Field',
    description: 'The Division Sigil activates. Iron becomes weather.',
    category: 'dominion',
    targetType: 'all',
    damage: 55,
    damageType: 'dominion_iron',
    accuracy: 88,
    cooldown: 3,
    currentCooldown: 0,
    staminaCost: 30,
    animation: 'screen_shake',
    flavorText: 'The wave on her coat glows. Iron pours off her like rain off a roof. Not plates. Not armor. A field. The air becomes iron-saturated, heavy, pressurized. Breathing hurts. Moving hurts more. This is what it means to fight a Prime: the battlefield itself takes her side.',
    missText: 'You push through the field. Every step costs. But you\'re an Oni with a Dragon Fruit and a grudge. Cost is just a number.',
    effects: [
      { type: 'weaken', value: 10, duration: 2, chance: 70, description: 'Iron-saturated atmosphere' },
      { type: 'bleed', value: 6, duration: 2, chance: 50, description: 'Micro-lacerations from iron particles' },
    ],
  },
];

const PRIME_KHOSS_PHASE_3_ACTIONS: CombatAction[] = [
  {
    id: 'khoss_the_quiet',
    name: 'The Quiet',
    description: 'Silence. Then everything.',
    category: 'special',
    targetType: 'single',
    damage: 95,
    damageType: 'dominion_iron',
    accuracy: 70,
    cooldown: 2,
    currentCooldown: 0,
    staminaCost: 40,
    animation: 'flash_red',
    flavorText: 'Khoss stops. Completely. No movement. No breathing. The Iron field contracts to her blade. Every particle, every fragment, every atom of Dominion she\'s projected, it all comes back. Condenses. The blade turns white. Then she moves. One step. One cut. The sound it makes is not a sound. It\'s an absence. A hole in the air where noise used to be.',
    missText: 'The cut passes you. The wall behind you, twenty feet of reinforced timber, separates into two pieces that slide apart. Slowly. She burned everything she had on that swing. She\'s breathing now. Heavily.',
    effects: [
      { type: 'bleed', value: 15, duration: 3, chance: 70, description: 'Prime execution cut' },
      { type: 'stun', value: 1, duration: 1, chance: 55, description: 'Atmospheric vacuum' },
    ],
  },
];

const khossBossPhases: BossPhase[] = [
  {
    id: 'khoss_phase_2',
    name: 'STORM GREY',
    hpThreshold: 60,
    narration: [
      'Khoss takes a step back. Blood on her sleeve. She looks at it.',
      'She doesn\'t speak. Doesn\'t react. She reaches up and undoes the top clasp of her coat. Then the second. Then the third.',
      'The Division Sigil on the back of the coat begins to glow. Pale blue. Then white. A cresting wave frozen mid-break, and the wave starts to move.',
      'Iron pours from the sigil. Not the controlled output of a career officer. Something deeper. The Iron of a woman who fought in two wars, commanded three divisions, and buried more subordinates than she can count. The coat doesn\'t come off. It transforms. The grey fabric stiffens, hardens, becomes plating. Living armor.',
      '"You\'re better than Vasshen reported." It\'s the first personal thing she\'s said. "That will make the paperwork more complicated."',
    ],
    statChanges: { attack: 8, speed: 4, defense: 5 },
    newActions: PRIME_KHOSS_PHASE_2_ACTIONS,
    aiPatternChange: 'aggressive',
    triggered: false,
  },
  {
    id: 'khoss_phase_3',
    name: 'THE QUIET',
    hpThreshold: 25,
    narration: [
      'Khoss is hurt. Badly. The living armor is cracked. Her left arm hangs wrong. Blood from a cut above her eye runs into her vision and she doesn\'t blink it away.',
      'She sheathes her blade.',
      'For three seconds, nothing happens. The ship creaks. Rain falls. Her soldiers watch from behind overturned barriers with the look of people watching something they\'ll tell their grandchildren about.',
      'Then the quiet comes.',
      'Sound dies. Not fades. Dies. The rain is still falling but you can\'t hear it. The waves are still moving but they\'re silent. Your own heartbeat goes mute.',
      'Khoss draws her blade. The motion is silent. The Iron on the blade is silent. Everything is silent because she has consumed every vibration in a fifty-foot radius and compressed it into the edge of a sword.',
      'She looks at you. For the first time, something in her eyes that isn\'t duty.',
      'Respect.',
    ],
    statChanges: { attack: 18, defense: -15, speed: -4 },
    newActions: PRIME_KHOSS_PHASE_3_ACTIONS,
    aiPatternChange: 'berserker',
    triggered: false,
  },
];

const primeKhoss: EnemyTemplate = {
  id: 'prime_khoss',
  name: 'Prime Edara Khoss',
  title: 'Wardensea Third Prime',
  tier: 'boss',
  portrait: 'prime_khoss',
  hp: 360,
  stamina: 160,
  attack: 34,
  defense: 34,
  speed: 26,
  dominion: { iron: 85, sight: 50, king: 40 },
  actions: PRIME_KHOSS_ACTIONS,
  aiPattern: 'tactical',
  flavorIntro: 'She boards your ship alone. No escort. No announcement. One moment the deck is empty and the next she\'s there, standing in the rain like she grew out of it. Storm-grey coat dark with water. Silver trim catching lightning. The Division Sigil on her shoulder, a wave frozen mid-break, glows faintly in the dim. She doesn\'t draw her weapon. She doesn\'t need to. The Iron radiating from her in idle makes your crew step back without deciding to. This is what a Prime feels like. Not a fighter. A force.',
  flavorDefeat: 'Khoss goes to one knee. The living armor cracks and falls away in grey shards. Her blade clatters to the deck. She stays there for a moment, breathing, bleeding, processing. Then she stands. Slow. Dignified. She picks up her blade. Sheathes it. Looks at you. "You have proven something today. I don\'t know what yet." She turns to the railing. Signals to her fleet. The ships begin to pull away. She doesn\'t look back. She doesn\'t threaten. She doesn\'t promise. Somehow, that\'s worse than all of it.',
  bossPhases: khossBossPhases,
};

const primeEliteOfficer: EnemyTemplate = {
  id: 'prime_elite_officer',
  name: 'Prime\'s Guard',
  title: 'Third Division Elite',
  tier: 'elite',
  hp: 126,
  stamina: 90,
  attack: 17,
  defense: 22,
  speed: 24,
  dominion: { iron: 45, sight: 25, king: 10 },
  actions: [
    {
      id: 'prime_guard_iron_cut',
      name: 'Tempered Cut',
      description: 'Third Division standard. Better than First Division standard.',
      category: 'strike',
      targetType: 'single',
      damage: 30,
      damageType: 'dominion_iron',
      accuracy: 86,
      cooldown: 0,
      currentCooldown: 0,
      staminaCost: 10,
      animation: 'slash',
      flavorText: 'The officer\'s blade is sharper than Vasshen\'s escorts. The technique is cleaner. Third Division trains harder. It shows.',
      missText: 'You block. The officer resets immediately. No frustration. Third Division discipline.',
    },
    {
      id: 'prime_guard_shield_wall',
      name: 'Prime\'s Wall',
      description: 'Position between the enemy and the Prime. Die if necessary.',
      category: 'defend',
      targetType: 'self',
      damage: 0,
      damageType: 'physical',
      accuracy: 100,
      cooldown: 2,
      currentCooldown: 0,
      staminaCost: 8,
      animation: 'block',
      flavorText: 'The officer steps between you and Khoss. Shield up. Eyes steady. These soldiers volunteered for Prime guard duty knowing the mortality rate. They\'re not afraid. They\'re honored.',
      missText: '',
      effects: [
        { type: 'buff_defense', value: 22, duration: 2, chance: 100, description: 'Prime\'s wall' },
      ],
    },
    {
      id: 'prime_guard_coordinated_strike',
      name: 'Division Strike',
      description: 'Paired attack. Third Division coordination.',
      category: 'strike',
      targetType: 'single',
      damage: 38,
      damageType: 'dominion_iron',
      accuracy: 78,
      cooldown: 2,
      currentCooldown: 0,
      staminaCost: 14,
      animation: 'slash',
      flavorText: 'Both guards move as one. Mirror image. The cuts come from opposite angles, timed to arrive simultaneously. Third Division trains this maneuver until it\'s reflex. It\'s not a technique. It\'s a habit.',
      missText: 'You break the pincer. The guards exchange a glance. Recalibrate. Try again.',
      effects: [
        { type: 'bleed', value: 6, duration: 2, chance: 35, description: 'Cross cut' },
      ],
    },
  ],
  aiPattern: 'defensive',
  flavorIntro: 'Third Division Prime\'s Guard. Handpicked. The best the Wardensea has below officer rank. They don\'t fight for money or promotion. They fight because Khoss chose them, and being chosen by a Prime is worth more than either.',
  flavorDefeat: 'The guard goes down. Clean. Professional. Even unconscious, the posture is regulation.',
};

export const primeKhossEncounter: CombatEncounter = {
  id: 'prime_khoss_confrontation',
  title: 'THE QUIET STORM',
  subtitle: 'Wardensea Third Prime. The sea remembers.',
  background: 'combat_bg_prime_khoss',
  narrativeIntro: [
    'The fleet came with the dawn. Twelve ships. Storm-grey hulls in formation, spread across the eastern approach like a wall. The Wardensea pennants hang limp in the rain. No wind. No wind at all. The sea is glass.',
    'Kovesse counts the ships three times. Her voice is flat. "That\'s not a patrol fleet. That\'s not even a response fleet. That\'s a blockade group. Third Division markings."',
    'Vorreth goes pale. You\'ve never seen Vorreth go pale.',
    '"Third Division," he says. "That\'s a Prime."',
    'She comes aboard your ship alone. No soldiers. No escort. She walks across the gangway in the rain and stands on your deck and looks at you the way a doctor looks at an X-ray.',
    '"Karyudon." Her voice is quiet. Not soft. Quiet. The difference matters. "I read Vasshen\'s report. I read your file. I read the Grimoire feeds and the intelligence assessments and the strategic projections."',
    'She draws her blade. The motion is unhurried.',
    '"None of it prepared me for this. So I came to see for myself."',
  ],
  narrativeVictory: [
    'The rain falls on a silent ship.',
    'Khoss stands at the railing. Her coat is shredded. The Division Sigil is cracked. Her blade is clean because she cleaned it before sheathing it. Even now. Even after losing. Discipline.',
    'She signals the fleet. A single gesture. The ships begin to turn. Twelve storm-grey hulls peeling away from the harbor in a formation that will be studied at the Academy for decades.',
    '"The blockade is lifted." Her voice is steady. "You have your sea."',
    'She looks at you one more time.',
    '"The Wardensea is larger than one fleet. Larger than one Prime. You know this."',
    '"I know."',
    '"Good." She steps onto the gangway. Pauses. "Vasshen was wrong about you. You\'re not a threat to be contained. You\'re a problem to be understood."',
    'She walks back to her ship. The fleet withdraws. The Bastion Sea is yours.',
    'For now.',
  ],
  narrativeDefeat: [
    'Khoss is too much. The Iron field alone would break most fighters, and she has thirty years of technique on top of it. You go down. Hard.',
    'She stands over you. Blade at her side. Not pointed at you. At her side.',
    '"You\'re remarkable. Truly." She\'s not mocking. She means it. "But remarkable is not enough. Not against the full weight of the Wardensea."',
    'She turns to her fleet. "Secure the harbor. All vessels. Standard arrest protocol."',
    'Vorreth steps forward. Delvessa moves to flank. The crew draws weapons.',
    'The situation is not resolved. But it just got a lot worse.',
  ],
  enemies: [primeKhoss, primeEliteOfficer, primeEliteOfficer],
  waves: [
    [primeEliteOfficer, primeEliteOfficer],
  ],
  rewards: [
    { type: 'reputation', value: 20, label: '+20 Reputation' },
    { type: 'infamy', value: 15, label: '+15 Infamy' },
    { type: 'bounty', value: 100000000, label: '+100M Bounty' },
    { type: 'sovereigns', value: 500, label: '+500 Sovereigns (seized Wardensea supplies)' },
    { type: 'intelligence', value: 30, label: '+30 Intelligence (Third Division deployment data)' },
  ],
  defeatConsequence: 'retreat',
  availableCrew: ['dragghen', 'vorreth', 'suulen', 'delvessa', 'kovesse', 'tessek', 'orren'],
  specialConditions: [
    'Reinforcement soldiers arrive every 4 turns (max 2 waves)',
    'Phase 2: Storm Field (+15 accuracy to all attacks)',
    'Phase 3: The Quiet (massive single-target damage, low accuracy)',
  ],
  onVictoryEffects: [
    { type: 'flag', target: 'prime_khoss_defeated', value: true },
    { type: 'flag', target: 'wardensea_blockade_broken', value: true },
    { type: 'notification', value: true, notification: {
      type: 'wardensea',
      title: 'WARDENSEA HIGH COMMAND - EMERGENCY SESSION',
      message: 'Third Prime Edara Khoss engaged the Oni fugitive Karyudon in direct combat aboard his vessel. The Third Prime was defeated. Third Division blockade fleet has withdrawn from Bastion Sea theater. This is the first defeat of a Wardensea Prime by a non-Conqueror in seventeen years. Threat classification: EXISTENTIAL. Requesting authorization for Anointed Seven deployment.',
    }},
  ],
  onDefeatEffects: [
    { type: 'flag', target: 'prime_khoss_defeated', value: false },
    { type: 'flag', target: 'prime_khoss_encounter_lost', value: true },
  ],
};


// ==========================================
// BOSS ENCOUNTERS - MASTER LIST
// ==========================================

export const bossEncounters: CombatEncounter[] = [
  vasshenEncounter,
  tessavarraEncounter,
  kolmariIroncladEncounter,
  tessurrenEncounter,
  marenKadeEncounter,
  captainHullEncounter,
  sableVennEncounter,
  kirinEncounter,
  primeKhossEncounter,
];
